<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>SimpleWord简词开发记录笔记 | bubble sky</title>
  <meta name="author" content="bubble">
  
  <meta name="description" content="Coding world, changing world ^_^">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="SimpleWord简词开发记录笔记"/>
  <meta property="og:site_name" content="bubble sky"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.ico" rel="icon" type="image/x-ico">
  <link rel="alternate" href="/atom.xml" title="bubble sky" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
	<script type="text/javascript">
		
		<script>
		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		  ga('create', 'UA-62747330-1', 'auto');
		  ga('send', 'pageview');

		</script>
	</script>


  
	<script type="text/javascript">
		#百度统计代码
		<script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "//hm.baidu.com/hm.js?086c69233d338486c8e682985d43bc2c";
		  var s = document.getElementsByTagName("script")[0]; 
		  s.parentNode.insertBefore(hm, s);
		})();
		</script>
	</script>

  <meta name="baidu-site-verification" content="AsGSFa0HbA" />

  <script type="text/javascript" name="baidu-tc-cerfication" data-appid="5864411" src="http://apps.bdimg.com/cloudaapi/lightapp.js"></script>
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">bubble sky</a></h1>
  <h2><a href="/">Coding world, changing world ^_^</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/About">About</a></li>
    
	<li> 
		<a href="/atom.xml">RSS</a> 
	</li>
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-08-06T07:06:40.000Z"><a href="/2015/08/06/SimpleWord-dev-log/">2015-08-06 15:06, 32nd周 Thursday</a></time>
      
      
  
    <h1 class="title">SimpleWord简词开发记录笔记</h1>
  

    </header>
    <div class="entry">
      

		      <!-- Table of Contents -->
          
          
        <p>之前开发“简算”的时候忘记记录了，有时间补上。。觉得养成记录的习惯比较好。。</p>
<p>2015-8-6 15:07:54</p>
<h1 id="1-词库">1.词库</h1><p>找不到词库，暂时找到一个带音标和释义的考研单词excel（估计是好几年前的大纲词汇），就先用这个吧。<br>excel不能显示音标的话，还得下载字体TOPhonetic.ttf。</p>
<h1 id="2-数据库">2.数据库</h1><p>1.excel导入SQLite<br>试了几个可视化工具，就SQLiyeStudio比较满意，也没有乱码。<br>开始时把excel另存为.csv文件，系统的分隔符是逗号，但是去控制面板改了，excel导出时还是逗号，不知道为什么，可能需要重启电脑吧，懒得重启。竟然忘记replace了！所以excel → 制表符分隔的txt → replace分隔符，就ok了^_^</p>
<ol>
<li><h1 id="3-优化">3.优化</h1><p>1.延迟切换fragment</p>
<p> public void switchContent(Fragment fragment) {</p>
<pre><code>contentFragment = fragment;
getFragmentManager<span class="literal">()</span>.beginTransaction<span class="literal">()</span>.replace(<span class="type">R</span>.id.content_frame, fragment).commit<span class="literal">()</span>;
</code></pre><p> //  sm.showContent();</p>
<pre><code><span class="type">Handler</span> h = <span class="keyword">new</span> <span class="type">Handler</span><span class="literal">()</span>;
h.postDelayed(<span class="keyword">new</span> <span class="type">Runnable</span><span class="literal">()</span> {
    public void run<span class="literal">()</span> {
        sm.showContent<span class="literal">()</span>;
    }
}, <span class="number">50</span>);
</code></pre><p> }</p>
</li>
</ol>
<p>2015-8-10 20:54:25</p>
<h1 id="1-单词本界面想做成卡片来滑动">1.单词本界面想做成卡片来滑动</h1><h2 id="1-RecyclerView">1.RecyclerView</h2><p>关于引入V7包：<a href="http://wp.aesean.com/?p=185" target="_blank" rel="external">http://wp.aesean.com/?p=185</a><br>2015-8-11 20:44:55</p>
<ol>
<li>继承RecyclerView.Adapter出现<em>The hierarchy of the type ViewHolder is inconsistent</em>，因为菜单用的SlidingMenu，support-v4包可能不是最新的，将SlidingMenu的libs下的v4包替换成最新的就可以了。</li>
<li><p><em>Call requires API level 21 (current min is 17): android.content.Context#getDrawable</em><br><a href="http://stackoverflow.com/questions/29041027/android-getresources-getdrawable-deprecated-api-22" target="_blank" rel="external">解决</a></p>
<p> ContextCompat.getDrawable(this, R.drawable.your_drawable)</p>
</li>
</ol>
<p>2015-8-12 </p>
<h1 id="在actionbar添加spinner下拉列表">在actionbar添加spinner下拉列表</h1><p>1.actionbar.xml</p>
<pre><code><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>  
<span class="tag">&lt;<span class="title">LinearLayout</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span>  
<span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span>  
<span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span>  
<span class="attribute">android:gravity</span>=<span class="value">"center_vertical"</span>  
<span class="attribute">android:orientation</span>=<span class="value">"horizontal"</span> &gt;</span>  

    <span class="tag">&lt;<span class="title">TextView</span>  
        <span class="attribute">android:id</span>=<span class="value">"@+id/action_bar_title"</span>  
        <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span>  
        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span>          
        <span class="attribute">android:text</span>=<span class="value">"下拉列表"</span> /&gt;</span>  

    <span class="comment">&lt;!-- 下拉列表  --&gt;</span>  
    <span class="tag">&lt;<span class="title">Spinner</span>  
        <span class="attribute">android:id</span>=<span class="value">"@+id/action_bar_spinner"</span>  
        <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span>  
        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span>  
        &gt;</span>  
    <span class="tag">&lt;/<span class="title">Spinner</span>&gt;</span>  

<span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span>  
</code></pre><p>2.在activity的onCreate()或fragment的onCreateView()中添加代码，初始化下拉列表数据</p>
<pre><code><span class="comment">//使自定义的普通View能在title栏显示，actionBar.setCustomView能起作用</span>
getActivity().getActionBar().setDisplayShowCustomEnabled(<span class="literal">true</span>); 
<span class="comment">//初始化下拉列表</span>
View actionbarLayout = view.inflate(activity,R.layout.actionbar, <span class="literal">null</span>);  
mActionbarSpinner = (Spinner) actionbarLayout.findViewById(R.id.actionbar_spinner);  

<span class="comment">//初始化下拉列表数据</span>
<span class="comment">//方法一  </span>
initSpinnerMethod1();  
<span class="comment">//方法二  </span>
<span class="comment">//initSpinnerMethod2();  </span>

<span class="comment">//事件监听  </span>
mActionbarSpinner.setOnItemSelectedListener(<span class="keyword">new</span> SpinnerItemSelectedListener());  

<span class="comment">//在Bar上显示定制view  </span>
actionBar.setCustomView(actionbarLayout); 
</code></pre><p>初始化下拉列表数据：<br>（1） 在strings.xml添加数组</p>
<pre><code>&lt;<span class="type">string</span>-array <span class="property">name</span>=<span class="string">"spinner_list"</span> &gt;  
&lt;<span class="property">item</span>&gt;item1&lt;/<span class="property">item</span>&gt;  
&lt;<span class="property">item</span>&gt;item2&lt;/<span class="property">item</span>&gt;  
&lt;<span class="property">item</span>&gt;item3&lt;/<span class="property">item</span>&gt;   
&lt;/<span class="type">string</span>-array&gt;  
</code></pre><p>代码：</p>
<pre><code><span class="keyword">private</span> void initSpinnerMethod1<span class="literal">()</span> {  
     <span class="type">String</span><span class="literal">[]</span> mItems = getResources<span class="literal">()</span>.getStringArray(<span class="type">R</span>.<span class="built_in">array</span>.spinner_list);  
     <span class="type">ArrayAdapter</span>&lt;<span class="type">String</span>&gt; spinnerAdapter = <span class="keyword">new</span> <span class="type">ArrayAdapter</span>&lt;<span class="type">String</span>&gt;(activity,android.<span class="type">R</span>.layout.simple_spinner_item, mItems);  
     spinnerAdapter.setDropDownViewResource(android.<span class="type">R</span>.layout.simple_spinner_dropdown_item);  
     mActionbarSpinner.setAdapter(spinnerAdapter);  
}  
</code></pre><p>（2）在代码中添加数组</p>
<pre><code><span class="keyword">private</span> <span class="built_in">List</span><span class="subst">&lt;</span><span class="built_in">String</span><span class="subst">&gt;</span> getData(){          
    <span class="built_in">List</span><span class="subst">&lt;</span><span class="built_in">String</span><span class="subst">&gt;</span> <span class="built_in">data</span> <span class="subst">=</span> <span class="literal">new</span> ArrayList<span class="subst">&lt;</span><span class="built_in">String</span><span class="subst">&gt;</span>();  
    <span class="built_in">data</span><span class="built_in">.</span>add(<span class="string">"item1"</span>);  
    <span class="built_in">data</span><span class="built_in">.</span>add(<span class="string">"item2"</span>);  
    <span class="built_in">data</span><span class="built_in">.</span>add(<span class="string">"item3"</span>);          
    <span class="keyword">return</span> <span class="built_in">data</span>;  
}  

<span class="keyword">private</span> <span class="literal">void</span> initSpinnerMethod2()  {  
    mActionbarSpinner<span class="built_in">.</span>setAdapter(  
            <span class="literal">new</span> ArrayAdapter<span class="subst">&lt;</span><span class="built_in">String</span><span class="subst">&gt;</span>(activity,   
                    android<span class="built_in">.</span>R<span class="built_in">.</span>layout<span class="built_in">.</span>simple_expandable_list_item_1,getData()));    
}  
</code></pre><p>3.监听action_bar的spinner的item选择事件</p>
<pre><code><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SpinnerItemSelectedListener</span> <span class="keyword">implements</span> <span class="title">OnItemSelectedListener</span> </span>{  

    <span class="annotation">@Override</span>  
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemSelected</span><span class="params">(AdapterView&lt;?&gt; arg0, View view, <span class="keyword">int</span> position,<span class="keyword">long</span> arg3)</span> </span>{  
         String str= arg0.getItemAtPosition(position).toString();  
         Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"你选择的是:"</span>+str, <span class="number">2000</span>).show();             
    }  

    <span class="annotation">@Override</span>  
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNothingSelected</span><span class="params">(AdapterView&lt;?&gt; arg0)</span> </span>{}  
}  
</code></pre><h1 id="同一个activity的不同fragment显示不同的actionbar">同一个activity的不同fragment显示不同的actionbar</h1><p>在单词本界面的actionbar想显示一个spinner下拉选择单词本（暂时未加入切换单词本的功能），在WordBookFragment的<code>onCreateView()</code>里设置自定义actionbar</p>
<pre><code>getActivity<span class="literal">()</span>.getActionBar<span class="literal">()</span>.setDisplayShowCustomEnabled(<span class="literal">true</span>);
</code></pre><p>别的fragment里设置</p>
<pre><code>getActivity<span class="literal">()</span>.getActionBar<span class="literal">()</span>.setDisplayShowCustomEnabled(<span class="literal">false</span>);
</code></pre><p>或者加载另外的view。</p>
<h1 id="不同fragment的标题">不同fragment的标题</h1><p>分别在<code>onCreateView()</code>里设置</p>
<pre><code>getActivity<span class="comment">()</span>.setTitle<span class="comment">("标题")</span>;
</code></pre><p>若写成</p>
<pre><code>getActivity<span class="literal">()</span>.getActionBar<span class="literal">()</span>.setTitle(<span class="string">"标题"</span>);    
</code></pre><p>会将所有fragment设置成同一标题</p>
<h1 id="在fragment里获取actionbar">在fragment里获取actionbar</h1><p><em>cannot convert from android.support.v7.app.ActionBar to android.app.ActionBar</em></p>
<pre><code><span class="attribute">ActionBar actionBar </span>=<span class="string"> getActivity.getActionBar();</span>
</code></pre><p>使用quick fix：</p>
<pre><code>android.<span class="keyword">app</span>.ActionBar actionBar;  
</code></pre><p>2015-8-18</p>
<h1 id="控件左右对齐">控件左右对齐</h1><p>使用<code>RelativeLayout</code></p>
<pre><code><span class="label">android:</span>layout_alignParentRight=<span class="string">"true"</span>
</code></pre><p>2015-8-19</p>
<h1 id="判断程序是否首次运行">判断程序是否首次运行</h1><p>使用<code>SharedPreferences</code>，在<code>onCreate()</code>里：</p>
<pre><code>SharedPreferences preferences;  
Editor <span class="keyword">editor</span>;  
<span class="keyword">if</span> (preferences.getBoolean(<span class="string">"firststart"</span>, true)) {  <span class="comment">//获取boolean值，可为缺省值，若缺省，则返回参数二的值</span>
    <span class="keyword">editor</span> = preferences.edit();  
    <span class="keyword">editor</span>.putBoolean(<span class="string">"firststart"</span>, false);  <span class="comment">//若是首次，则改为false</span>
    <span class="keyword">editor</span>.commit();  <span class="comment">//提交</span>
}  
</code></pre><p>2015-8-20</p>
<h1 id="状态栏通知">状态栏通知</h1><h2 id="可删除">可删除</h2><pre><code>NotificationCompat.Builder mBuilder =
    <span class="keyword">new</span> NotificationCompat.Builder(<span class="keyword">this</span>)
    .setSmallIcon(R.drawable.notification_icon)
    .setContentTitle(<span class="string">"My notification"</span>)
    .setContentText(<span class="string">"Hello World!"</span>);
<span class="comment">// Creates an explicit intent for an Activity in your app</span>
Intent resultIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, ResultActivity.<span class="keyword">class</span>);
<span class="comment">// The stack builder object will contain an artificial back stack for the</span>
<span class="comment">// started Activity.</span>
<span class="comment">// This ensures that navigating backward from the Activity leads out of</span>
<span class="comment">// your application to the Home screen.</span>
TaskStackBuilder stackBuilder = TaskStackBuilder.create(<span class="keyword">this</span>);
<span class="comment">// Adds the back stack for the Intent (but not the Intent itself)</span>
stackBuilder.addParentStack(ResultActivity.<span class="keyword">class</span>);
<span class="comment">// Adds the Intent that starts the Activity to the top of the stack</span>
stackBuilder.addNextIntent(resultIntent);
PendingIntent resultPendingIntent =
        stackBuilder.getPendingIntent(
            <span class="number">0</span>,
            PendingIntent.FLAG_UPDATE_CURRENT
        );
mBuilder.setContentIntent(resultPendingIntent);
NotificationManager mNotificationManager =
    (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE);
<span class="comment">// mId allows you to update the notification later on.</span>
mNotificationManager.notify(mId, mBuilder.build());
</code></pre><h2 id="常驻状态栏（显示在“进行中/ongoing”）">常驻状态栏（显示在“进行中/ongoing”）</h2><h3 id="Notification">Notification</h3><ul>
<li><p>低于API 11</p>
<p>  notification.flags |= Notification.FLAG_NO_CLEAR;</p>
</li>
<li><p>高于API 11 或者 使用Android Support Library</p>
<p>  //获取状态通知栏管理<br>  NotificationManager mNotificationManager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);<br>  //实例化通知栏构造器<br>  NotificationCompat.Builder mBuilder = new NotificationCompat.Builder(this);<br>  mBuilder.setSmallIcon(R.drawable.ic_launcher);//设置通知小图标</p>
<pre><code>.<span class="function"><span class="title">setContentTitle</span><span class="params">(<span class="string">"标题"</span>)</span></span>  <span class="comment">//设置通知栏标题</span>
.<span class="function"><span class="title">setContentText</span><span class="params">(<span class="string">"内容"</span>)</span></span>   <span class="comment">//设置通知栏显示内容</span>
.<span class="function"><span class="title">setContentIntent</span><span class="params">(getDefalutIntent(Notification.FLAG_AUTO_CANCEL)</span></span>) <span class="comment">//设置通知栏点击意图</span>
.<span class="function"><span class="title">setNumber</span><span class="params">(number)</span></span> <span class="comment">//设置通知集合的数量</span>
.<span class="function"><span class="title">setTicker</span><span class="params">(<span class="string">"通知来啦"</span>)</span></span> <span class="comment">//通知首次出现在通知栏，带上升动画效果的</span>
.<span class="function"><span class="title">setWhen</span><span class="params">(System.currentTimeMillis()</span></span>)<span class="comment">//通知产生的时间，会在通知信息里显示，一般是系统获取到的时间</span>
.<span class="function"><span class="title">setPriority</span><span class="params">(Notification.PRIORITY_DEFAULT)</span></span> <span class="comment">//设置该通知优先级</span>
.<span class="function"><span class="title">setAutoCancel</span><span class="params">(true)</span></span><span class="comment">//设置这个标志当用户单击面板就可以让通知将自动取消  </span>
.<span class="function"><span class="title">setOngoing</span><span class="params">(false)</span></span><span class="comment">//ture，设置他为一个正在进行的通知。他们通常是用来表示一个后台任务,用户积极参与(如播放音乐)或以某种方式正在等待,因此占用设备(如一个文件下载,同步操作,主动网络连接)</span>
.<span class="function"><span class="title">setDefaults</span><span class="params">(Notification.DEFAULT_VIBRATE)</span></span><span class="comment">//向通知添加声音、闪灯和振动效果的最简单、最一致的方式是使用当前的用户默认设置，使用defaults属性，可以组合</span>
</code></pre><p>  //Notification.DEFAULT_ALL  Notification.DEFAULT_SOUND 添加声音 // requires VIBRATE permission</p>
</li>
</ul>
<h3 id="service前台服务">service前台服务</h3><p>在service里</p>
<pre><code>startForeground<span class="list">(<span class="keyword">mID</span>, notification)</span><span class="comment">;     //设置前台服务</span>
</code></pre><h1 id="关于服务service">关于服务service</h1><ul>
<li>启动service的时候，<code>onCreate</code>方法只有第一次会调用，<code>onStartCommand</code>和<code>onStart</code>（已被淘汰）每次都被调用。<code>onStartCommand</code>会告诉系统如何重启服务，如判断是否异常终止后重新启动，在何种情况下异常终止。</li>
<li>2.0 API level之后，实现onStart等同于重写onStartCommand并返回START_STICKY 。</li>
<li>2.0 API level之后，onStart()方法被onStartCommand()取代了。</li>
<li><p>必须在AndroidManifest.xml中注册</p>
  <service android:name="完整包名.ServiceNotification">

</service></li>
</ul>
<h2 id="启动服务">启动服务</h2><pre><code>mContext.startService(<span class="type">intent</span>);
</code></pre><h2 id="关闭服务">关闭服务</h2><pre><code>mContext.stopService(<span class="type">intent</span>);
</code></pre><h1 id="保存、恢复spinner的选中项">保存、恢复spinner的选中项</h1><h2 id="保存">保存</h2><p>在<code>onItemSelected()</code>中</p>
<pre><code><span class="built_in">int</span> userChoice = spinner.getSelectedItemPosition<span class="literal">()</span>;
<span class="type">SharedPreferences</span> sharedPref = getSharedPreferences(<span class="string">"FileName"</span>,<span class="number">0</span>);
<span class="type">SharedPreferences</span>.<span class="type">Editor</span> prefEditor = sharedPref.edit<span class="literal">()</span>;
prefEditor.putInt(<span class="string">"userChoiceSpinner"</span>,usersChoice);
prefEditor.commit<span class="literal">()</span>;
</code></pre><h2 id="恢复">恢复</h2><pre><code>SharedPreferences <span class="variable">sharedPref =</span> getSharedPreferences(<span class="string">"FileName"</span>,MODE_PRIVATE);
int <span class="variable">spinnerValue =</span> sharedPref.getInt<span class="string">"userChoiceSpinner"</span>,-<span class="number">1</span>);
<span class="keyword">if</span>(spinnerValue != -<span class="number">1</span>) 
    spinner.setSelection(spinnerValue);
</code></pre><h1 id="关于Activity生命周期该做的事情">关于Activity生命周期该做的事情</h1><h2 id="onCreate()">onCreate()</h2><ul>
<li>使用<code>onCreate()</code>初始化你的Activity：创建UI、为类的变量分配引用、绑定数据到控件、创建Service和线程。</li>
<li>为避免快速的创建和销毁对象引发额外的垃圾回收，如果你的应用程序正常创建一套对象，建议它们在<code>onCreate()</code>中创建，因为在Activity的生命周期中它只被调用一次。</li>
<li><code>onCreate()</code>里面尽量少做事情，避免程序启动太久都看不到界面。</li>
</ul>
<h2 id="onResume()">onResume()</h2><p>当从<code>Paused</code>状态恢复activity时，系统会调用<code>onResume()</code>方法。<br>系统每次调用<code>onResume()</code>时，activity都处于前台，包括第一次创建的时候。所以，应该实现<code>onResume()</code>来初始化那些在<code>onPause</code>方法里面释放掉的组件，并执行那些activity每次进入<code>Resumed state</code>都需要的初始化动作 (例如开始动画与初始化那些只有在获取用户焦点时才需要的组件)</p>
<h2 id="onPause()">onPause()</h2><ul>
<li>不应使用<code>onPause()</code>来保存用户改变的数据 (例如填入表格中的个人信息) 到永久存储(File或者DB)上。仅仅当确认用户期待那些改变能够被自动保存的时候(例如正在撰写邮件草稿)，才把那些数据存到永久存储 。</li>
<li>避免在<code>onPause()</code>时执行CPU-intensive 的工作，例如写数据到DB，因为它会导致切换到下一个activity变得缓慢(应该把那些heavy-load的工作放到onStop()去做)。</li>
<li>如果activity实际上是要被Stop，为了切换的顺畅应减少在OnPause()方法里面的工作量。</li>
<li>停止动画或者是其他正在运行的操作，那些都会导致CPU的浪费.</li>
<li>提交在用户离开时期待保存的内容(例如邮件草稿).</li>
<li>释放系统资源，例如broadcast receivers, sensors (比如GPS), 或者是其他任何会影响到电量的资源。</li>
</ul>
<h2 id="onStop()">onStop()</h2><ul>
<li>当activity调用<code>onStop()</code>方法, activity不再可见，并且应该释放那些不再需要的所有资源。一旦activity停止了，系统会在需要内存空间时摧毁它的实例。极端情况下，系统会直接杀死我们的app进程，并不执行activity的<code>onDestroy()</code>回调方法, 因此我们需要使用<code>onStop()</code>来释放资源，从而避免内存泄漏。<br>所以我们应该使用<code>onStop()</code>来执行那些耗时的释放资源的操作，例如往数据库写信息。<br>-无论什么原因导致activity停止，系统总是会在<code>onStop()</code>之前调用<code>onPause()</code>方法。</li>
</ul>
<h2 id="onDestroy()">onDestroy()</h2><p>大多数app并不需要实现这个方法，因为局部类的references会随着activity的销毁而销毁，并且我们的activity应该在<code>onPause()</code>与<code>onStop()</code>中执行清除activity资源的操作。然而，如果activity含有在onCreate调用时创建的后台线程，或者是其他有可能导致内存泄漏的资源，则应该在<code>OnDestroy()</code>时进行资源清理，杀死后台线程。</p>
<p>除非程序在<code>onCreate()</code>方法里面就调用了<code>finish()</code>方法，系统通常是在执行了<code>onPause()</code>与<code>onStop()</code>之后再调用<code>onDestroy()</code>。在某些情况下，例如我们的activity只是做了一个临时的逻辑跳转的功能，它只是用来决定跳转到哪一个activity，这样的话，需要在onCreate里面调用<code>finish</code>方法，这样系统会直接调用<code>onDestory</code>，跳过生命周期中的其他方法。</p>
<h2 id="与Activity生命周期结合的应用场景">与Activity生命周期结合的应用场景</h2><ul>
<li>与广播(Broadcast)结合<br>在<code>onResume</code>注册广播(registerLinstener)，在<code>onPause</code>注销广播(unregisterLinstener)。<br>例如：做”摇一摇”功能（传感器）、监听网络变化，就可以在onResume中注册监听，在onPause里注销掉，已节省资源提高效率。</li>
<li>与服务(Service)结合<br>在<code>onStartCommand</code>绑定服务(bindService)，在<code>onStop</code>中取消绑定(unbindService)。<br>例如：需要通过Service定时更新UI上的数据，而Activity的可见周期在<code>onStart</code>与<code>onStop</code>之间，那么就可以再<code>onStart</code>时启动服务，在<code>onStop</code>时停止服务。为了节约系统资源，除了提高用户体验以外，开发人员应尽可能的优化程序。</li>
<li>与Cursor结合<br>使用<code>managedQuery让Activity</code>帮你管理<code>Cursor</code>的生命周期，不用自己去close。</li>
<li>释放资源<br>可以在<code>onDestory</code>中释放一些资源。比如可以在<code>onDestory</code>时调用MediaPlayer的release。</li>
</ul>
<h1 id="AlarmManager定时启动Service">AlarmManager定时启动Service</h1><pre><code><span class="keyword">private</span> <span class="keyword">static</span> AlarmManager am;
<span class="keyword">private</span> <span class="keyword">static</span> PendingIntent pendingIntent;
<span class="comment">/**
 * 使用 AlarmManager 来 定时启动服务
 */</span>
<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startPendingIntent</span><span class="params">(Context context)</span> </span>{
    am = (AlarmManager) context.getSystemService(Context.ALARM_SERVICE);
    Intent intent = <span class="keyword">new</span> Intent(context, MyService.class);<span class="comment">//启动示例Service</span>
    pendingIntent = PendingIntent.getService(context, <span class="number">0</span>, intent, <span class="number">0</span>);
    <span class="keyword">long</span> interval = DateUtils.MINUTE_IN_MILLIS * <span class="number">30</span>;<span class="comment">// 30分钟一次</span>
    <span class="keyword">long</span> firstWake = System.currentTimeMillis() + interval;
    am.setRepeating(AlarmManager.RTC, firstWake, interval, pendingIntent);
}
<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">stopPendingIntent</span><span class="params">()</span> </span>{
    <span class="keyword">if</span> (pendingIntent != <span class="keyword">null</span>) {
        <span class="keyword">if</span> ( am == <span class="keyword">null</span>) {
            am = (AlarmManager) mContext.getSystemService(Context.ALARM_SERVICE);
        }
        am.cancel(pendingIntent);
        pendingIntent.cancel();
    }
};
</code></pre><p>参考：<a href="http://www.cnblogs.com/code4app/p/3688115.html" target="_blank" rel="external">android 使用AlarmManager定时启动service</a></p>
<h2 id="Timer与AlarmManager的区别">Timer与AlarmManager的区别</h2><p>通过调用Thread类的<code>start()</code>方法来启动一个线程，这时此线程处于就绪（可运行）状态，但此时并没有运行，它需要<code>CPU时间片</code>。一旦得到CPU时间片，就会执行<code>run()</code>方法。<code>run()</code>的方法体称为<code>线程体</code>，它包含了要执行的这个线程的内容，<code>run()</code>方法运行结束，此线程也随即终止。</p>
<p>Android 平台上常用的定时器主要有两个：</p>
<ul>
<li>Java的Timer</li>
<li>Android的AlarmManager</li>
</ul>
<h3 id="Timer">Timer</h3><p>Java的<code>Timer</code>类可以用来计划需要<strong>循环执行</strong>的任务。</p>
<p>简单的说，一个<code>Timer</code>内部封装装了“一个<code>Thread</code>”和“一个<code>TimerTask</code>队列”，这个队列按照一定的方式将任务排队处理。封装的<code>Thread</code>在<code>Timer</code>的构造方法调用时被启动，这个<code>Thread</code>的<code>run</code>方法按照条件去循环这个<code>TimerTask</code>队列，然后调用<code>TimerTask</code>的<code>run</code>方法。</p>
<p>但是，如果CPU进入了休眠状态，那么这个thread将会因为失去CPU时间片而阻塞，从而造成我们需要的<strong>定时任务失效</strong>。上述定时任务失效的场景分析：假设定时任务的条件是到了时间xx:yy才能执行，但由于cpu休眠造成线程阻塞的关系，当前系统时间超过了这个时间，即便CPU从终端中恢复了，那么由于条件不满足，定时任务在这一次自然就失效了。</p>
<p>解决方案：它需要用<code>WakeLock</code>让CPU保持唤醒状态。但这样会大量消耗手机电量，大大减短手机待机时间。这种方式不能满足我们的需求。</p>
<p>注：<code>TimerTask</code>实现<code>Runnable</code>接口，但它的<code>run</code>方法只是简单的在<code>Timer</code>中封装的<code>Thread</code>中被调用，并未将其放在其它线程中执行。也就是说<code>timer</code>是<strong>单线程</strong>执行的，那么问题来了，为何要这么费劲的封装一个Runnable接口又不进行多线程调用？</p>
<h3 id="AlarmManager">AlarmManager</h3><p><code>AlarmManager</code>是Android 系统封装的用于<code>管理RTC</code>的模块，<code>RTC(Real Time Clock)</code>是一个独立的硬件时钟，可以在 CPU休眠时正常运行，在预设的时间到达时，通过中断唤醒CPU。这意味着，如果我们用 <code>AlarmManager</code>来定时执行任务，CPU 可以正常的休眠，只有在需要运行任务时醒来一段很短的时间。</p>
<p>参考：<a href="http://blog.csdn.net/xplee0576/article/details/37928251" target="_blank" rel="external">Timer与AlarmManager的区别</a></p>
<h1 id="Switch开关">Switch开关</h1><pre><code><span class="keyword">Switch</span> mSwitch = (<span class="keyword">Switch</span>)view.findViewById(R.id.setting_switch_notification_word); 
    mSwitch.setOnCheckedChangeListener(<span class="keyword">new</span> OnCheckedChangeListener(){

        <span class="keyword">public</span> <span class="keyword">void</span> onCheckedChanged(CompoundButton buttonView,<span class="keyword">boolean</span> isChecked) {
            <span class="keyword">if</span> (isChecked) {    
                <span class="comment">// switch on，开启通知栏单词</span>
                intentNotiService = <span class="keyword">new</span> Intent(mContext, ServiceNotification.<span class="keyword">class</span>);
                pendingIntentNotiService = PendingIntent.getService(mContext, <span class="number">0</span>, intentNotiService, <span class="number">0</span>);
                minute = <span class="number">1</span>;
                startPendingIntent(pendingIntentNotiService);
            } <span class="keyword">else</span> {
                <span class="comment">//switch off，关闭通知栏单词</span>
                stopPendingIntent(pendingIntentNotiService);
            }
        }
    });
</code></pre><p>2015-8-21</p>
<h1 id="解决定时启动通知服务时pop_up无效">解决定时启动通知服务时pop up无效</h1><p>在Service的<code>onStartCommand()</code>里更新每次Notification需要更新的内容，如单词信息。无需改动的信息在<code>onCreate()</code>里初始化。</p>
<ul>
<li><p>原代码：</p>
<p>  @Override<br>  public int onStartCommand(Intent intent, int flags, int startId) {</p>
<pre><code>mBuilder
    .<span class="built_in">set</span>ContentText(WordsDB.wordClass.<span class="keyword">to</span>String())   //测试用的单词信息
    .<span class="built_in">set</span>When(System.currentTimeMillis())    //更新的时间
    .<span class="built_in">set</span>Ticker(WordsDB.wordClass.<span class="keyword">to</span>String());   //在通知栏动画向上弹出
startForeground(notifyID, mBuilder.build());    //display <span class="keyword">in</span> <span class="string">"ongoing"</span>
Log.d(<span class="string">"通知栏单词"</span>, WordsDB.wordClass.<span class="keyword">to</span>String());
return super.<span class="keyword">on</span>StartCommand(intent, <span class="keyword">flags</span>, startId);
</code></pre><p>  }<br>按钮点击时会更新notification，也会在通知栏弹出提示。<br>但使用<code>AlarmManager</code>定时启动该service时，会更新内容，但不会在通知栏弹出提示，只能自己打开通知栏才能查看到更新。</p>
</li>
<li><p>改动：使用<code>NotificationManager.notify()</code></p>
<p>  @Override<br>  public int onStartCommand(Intent intent, int flags, int startId) {</p>
<pre><code>mBuilder
    .<span class="built_in">set</span>ContentText(WordsDB.wordClass.<span class="keyword">to</span>String())
    .<span class="built_in">set</span>When(System.currentTimeMillis())
    .<span class="built_in">set</span>Ticker(WordsDB.wordClass.<span class="keyword">to</span>String());   //popup <span class="keyword">in</span> Status Bar
mNotificationManager.notify(notifyID, notification);    //update data
startForeground(notifyID, mBuilder.build());    //display <span class="keyword">in</span> <span class="string">"ongoing"</span>
Log.d(<span class="string">"通知栏单词"</span>, WordsDB.wordClass.<span class="keyword">to</span>String());
return super.<span class="keyword">on</span>StartCommand(intent, <span class="keyword">flags</span>, startId);
</code></pre><p>  }</p>
</li>
</ul>
<p><code>notify</code>必须在<code>startForeground</code>前面，先更新通知的内容，再显示在前台。<br><code>notifyID</code>需一致。</p>
<p>参考：<a href="http://stackoverflow.com/questions/5528288/how-do-i-update-the-notification-text-for-a-foreground-service-in-android" target="_blank" rel="external">How do I update the notification text for a foreground service in Android?</a></p>
<p>2015-8-22</p>
<h1 id="输入自定义更新时间间隔">输入自定义更新时间间隔</h1><p>用了3个EditText，分别输入小时、分钟、秒，默认30秒更新一次，即00:00:30<br>获取焦点时自动清空EditText，失去焦点时若未输入任何内容，则回到默认值</p>
<h2 id="关于离开EditText时无法失焦（触摸EditText外的位置）">关于离开EditText时无法失焦（触摸EditText外的位置）</h2><p>在其parent view设置xml属性：</p>
<pre><code><span class="label">android:</span>clickable=<span class="string">"true"</span>
<span class="label">android:</span>focusable=<span class="string">"true"</span>
<span class="label">android:</span>focusableInTouchMode=<span class="string">"true"</span>
</code></pre><h1 id="隐藏软键盘keyboard">隐藏软键盘keyboard</h1><p>1.在parent view设置</p>
<pre><code><span class="label">android:</span>clickable=<span class="string">"true"</span> 
<span class="label">android:</span>focusableInTouchMode=<span class="string">"true"</span> 
</code></pre><p>2.hideKeyboard() method</p>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">hideKeyboard</span><span class="params">(View view)</span> </span>{
    InputMethodManager inputMethodManager =(InputMethodManager)getSystemService(Activity.INPUT_METHOD_SERVICE);
    inputMethodManager.hideSoftInputFromWindow(view.getWindowToken(), <span class="number">0</span>);
}
</code></pre><p>参考：<a href="http://stackoverflow.com/questions/4165414/how-to-hide-soft-keyboard-on-android-after-clicking-outside-edittext" target="_blank" rel="external">how to hide soft keyboard on android after clicking outside EditText?</a></p>
<p>2015-8-28</p>
<h1 id="改进：通过广播Broadcast启动服务service">改进：通过广播Broadcast启动服务service</h1><h2 id="Broadcast静态registerReceiver与动态注册的区别">Broadcast静态registerReceiver与动态<receiver>注册的区别</receiver></h2><p>1.动态注册的广播永远要快于静态注册的广播,不管静态注册的优先级设置的多高,不管动态注册的优先级有多低</p>
<p>2.动态注册广播不是常驻型广播，也就是说广播跟随activity的生命周期。<br>注意: 在activity结束前，移除广播接收器。</p>
<p>静态注册是常驻型，也就是说当应用程序关闭后，如果有信息广播来，程序也会被系统调用自动运行。</p>
<p>3.在同一个优先级下,谁先启动的快,谁将先接收到广播。</p>
<p>动态注册代码:</p>
<pre><code>MyBroadcastReceiver  broadcast= new MyBroadcastReceiver<span class="list">()</span><span class="comment">;</span>
IntentFilter filter = new IntentFilter<span class="list">(<span class="string">"action_name"</span>)</span><span class="comment">;</span>
registerReceiver<span class="list">(<span class="keyword">broadcast</span>, filter)</span><span class="comment">;</span>
</code></pre><p>静态注册代码(在Manifest.xml中添加):</p>
<pre><code><span class="tag">&lt;<span class="title">receiver</span> <span class="attribute">android:name</span>=<span class="value">"com.example.MyReceiver"</span> &gt;</span>
    <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span>
        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"action_name"</span> /&gt;</span> //可自定义action_name
    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span>
 <span class="tag">&lt;/<span class="title">receiver</span>&gt;</span>
</code></pre><p>2015-8-29</p>
<h1 id="Slidingmenu的bug">Slidingmenu的bug</h1><p>在设置如下时</p>
<pre><code>sm.<span class="built_in">set</span>TouchModeAbove(SlidingMenu.TOUCHMODE_FULLSCREEN);
sm.<span class="built_in">set</span>TouchModeBehind(SlidingMenu.TOUCHMODE_FULLSCREEN);
</code></pre><p>1.菜单里的listview无法点击，解决：<br>在Slidingmenu_lib里，</p>
<ul>
<li>修改<code>CustomViewAbove.java</code>，将<code>onInterceptTouchEvent()</code>和<code>onTouchEvent()</code>的<code>case MotionEvent.ACTION_DOWN:</code>的<code>break;</code>改为<code>return mQuickReturn;</code><br>去掉<code>initCustomViewAbove()</code>里的<code>setInternalPageChangeListener()</code></li>
<li>修改<code>CustomViewBehind.java</code>，将<code>onInterceptTouchEvent()</code>和<code>onTouchEvent()</code>的<code>return</code>分别改为<code>return mViewAbove.onInterceptTouchEvent(e);</code>和<code>return mViewAbove.onTouchEvent(e);</code></li>
</ul>
<p>2.上述步骤后，若aboveview无法滑动，则在aboveview的root layout里添加<code>android:clickable=&quot;true&quot;</code></p>
<p>参考：<a href="https://github.com/jfeinstein10/SlidingMenu/issues/446#issuecomment-133709634" target="_blank" rel="external">All touch events are consumed by CustomViewAbove #446</a></p>
<p>2015-8-31</p>
<h1 id="悬浮窗单词">悬浮窗单词</h1><p>参考教程：<a href="http://blog.csdn.net/guolin_blog/article/details/8689140" target="_blank" rel="external">Android桌面悬浮窗效果实现，仿360手机卫士悬浮窗效果</a></p>
<h2 id="基本步骤">基本步骤</h2><p>1.在Manifest.xml声明权限</p>
<pre><code><span class="comment">&lt;!-- 显示顶层浮窗 --&gt;</span>
<span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.SYSTEM_ALERT_WINDOW"</span> /&gt;</span>
</code></pre><p>注意：在MIUI上需要在设置中打开本应用的“显示悬浮窗”开关，并且重启应用，否则悬浮窗只能显示在本应用界面内，不能显示在手机桌面上。<br>2.获取WindowManager</p>
<pre><code><span class="comment">// 获取应用的Context</span>
<span class="constant">Context mContext</span> = context.getApplicationContext();
<span class="comment">// 获取WindowManager</span>
<span class="constant">WindowManager mWindowManager</span> = (WindowManager) mContext.getSystemService(Context.WINDOW_SERVICE);
</code></pre><p>3.获取layout</p>
<pre><code>LayoutInflater.<span class="keyword">from</span>(mContext).inflate(R.layout.float_window, this);  
View view = findViewById(R.<span class="property">id</span>.window_layout);  
</code></pre><p>4.参数设置</p>
<pre><code><span class="variable">smallWindowParams =</span> new LayoutParams();  
//LayoutParams.TYPE_PHONE: 全屏区域显示(不含状态栏)
//LayoutParams.TYPE_SYSTEM_ALERT: 全屏区域显示(包含状态栏区域,被状态栏覆盖)
//LayoutParams.TYPE_SYSTEM_ERROR: 全屏区域显示(包含状态栏区域，覆盖在状态栏上)
smallWindowParams.<span class="variable">type =</span> LayoutParams.TYPE_SYSTEM_ERROR;  
//设置图片格式：背景透明
smallWindowParams.<span class="variable">format =</span> PixelFormat.RGBA_8888;  
//FLAG_LAYOUT_IN_SCREEN：可在状态栏上显示
smallWindowParams.<span class="variable">flags =</span>  LayoutParams.FLAG_NOT_TOUCH_MODAL | LayoutParams.FLAG_NOT_FOCUSABLE | LayoutParams.FLAG_LAYOUT_IN_SCREEN;  
smallWindowParams.<span class="variable">gravity =</span> Gravity.LEFT | Gravity.TOP;  
smallWindowParams.<span class="variable">width =</span> ViewSmallFloatWindow.viewWidth;  
smallWindowParams.<span class="variable">height =</span> ViewSmallFloatWindow.viewHeight;  
smallWindowParams.<span class="variable">x =</span> <span class="number">0</span>;  
smallWindowParams.<span class="variable">y =</span> Util.getStatusBarHeight(context);  
</code></pre><h2 id="让悬浮窗显示在状态栏上层">让悬浮窗显示在状态栏上层</h2><pre><code>LayoutParams.TYPE_SYSTEM_ERROR <span class="comment">//在全屏区域显示（可在状态栏显示，覆盖状态栏）</span>
LayoutParams.FLAG_NOT_TOUCH_MODAL <span class="string">| LayoutParams.FLAG_NOT_FOCUSABLE | LayoutParams.FLAG_LAYOUT_IN_SCREEN;</span>
</code></pre><p>注：</p>
<ul>
<li>这样设置下拉通知栏也会显示在悬浮窗下层。</li>
<li><code>FLAG_NOT_TOUCH_MODAL</code>和<code>FLAG_NOT_FOCUSABLE</code>任选其一都可以，若只设置<code>FLAG_LAYOUT_IN_SCREEN</code>会导致悬浮窗的焦点变成全屏（悬浮窗外无法操作）。<code>smallWindowParams.flags =  LayoutParams.FLAG_NOT_TOUCH_MODAL | LayoutParams.FLAG_NOT_FOCUSABLE | LayoutParams.FLAG_LAYOUT_IN_SCREEN | LayoutParams.FLAG_LAYOUT_INSET_DECOR | LayoutParams.FLAG_WATCH_OUTSIDE_TOUCH;</code>也可以。</li>
</ul>
<h2 id="WindowManager">WindowManager</h2><ul>
<li><code>addView</code>：添加一个悬浮窗，</li>
<li><code>updateViewLayout</code>：更新悬浮窗的参数，</li>
<li><code>removeView</code>：移除悬浮窗。</li>
</ul>
<p><code>WindowManager.LayoutParams</code>这个类用于提供悬浮窗所需的参数，其中有几个经常会用到的变量：</p>
<ul>
<li><p><code>type</code>：确定悬浮窗的类型，一般设为2002，表示在所有应用程序之上，但在状态栏之下。</p>
</li>
<li><p><code>flags</code>：确定悬浮窗的行为，比如说不可聚焦，非模态对话框等等，属性非常多，大家可以查看文档。</p>
</li>
<li><p><code>gravity</code>：确定悬浮窗的对齐方式，一般设为左上角对齐，这样当拖动悬浮窗的时候方便计算坐标。</p>
</li>
<li><p><code>x</code>：确定悬浮窗的位置，如果要横向移动悬浮窗，就需要改变这个值。</p>
</li>
<li><p><code>y</code>：确定悬浮窗的位置，如果要纵向移动悬浮窗，就需要改变这个值。</p>
</li>
<li><p><code>width</code>：指定悬浮窗的宽度。</p>
</li>
<li><p><code>height</code>：指定悬浮窗的高度。</p>
</li>
</ul>
<h2 id="获取屏幕宽度和高度">获取屏幕宽度和高度</h2><p>Display中getHeight()和getWidth()被废弃</p>
<pre><code><span class="type">Display</span> dp=getWindowManager().getDefaultDisplay();
<span class="type">int</span> <span class="type">Height</span>=dp.getHeight();  ----&gt;<span class="type">The</span> <span class="keyword">method</span> getHeight() <span class="keyword">from</span> the <span class="keyword">type</span> <span class="type">Display</span> <span class="keyword">is</span> deprecated
<span class="type">int</span> <span class="type">Width</span>=dp.getWidth();    ----&gt;<span class="type">The</span> <span class="keyword">method</span> getWidth() <span class="keyword">from</span> the <span class="keyword">type</span> <span class="type">Display</span> <span class="keyword">is</span> deprecated
</code></pre><p>替代的方法：</p>
<pre><code><span class="comment">//WindowManager wm = this.getWindowManager();</span>
<span class="constant">WindowManager wm</span> = (WindowManager) getContext().getSystemService(Context.WINDOW_SERVICE);

<span class="comment">//DisplayMetrics dm = new DisplayMetrics();</span>
<span class="comment">//wm.getDefaultDisplay().getMetrics(dm);</span>
<span class="constant">DisplayMetrics dm</span> = Resources.getSystem().getDisplayMetrics();
<span class="constant">
SCREEN_WIDTH</span> = dm.widthPixels;
<span class="constant">SCREEN_HEIGHT</span> = dm.heightPixels;
</code></pre><p>解析heightPixels和widthPixels：</p>
<pre><code><span class="keyword">public</span> <span class="built_in">int</span>     heightPixels    The absolute <span class="variable">height</span> of the display in <span class="variable">pixels</span>.
<span class="keyword">public</span> <span class="built_in">int</span>     widthPixels     The absolute <span class="variable">width</span> of the display in <span class="variable">pixels</span>.
</code></pre><p>参考：<br>1.<a href="http://www.cnblogs.com/lyyh-victory/p/3760014.html" target="_blank" rel="external">Display中getHeight()和getWidth() 官方废弃</a><br>2.<a href="http://stackoverflow.com/questions/8632970/how-to-get-screen-metrics-outside-an-activity" target="_blank" rel="external">How to get Screen metrics outside an Activity?</a></p>
<h2 id="点击手机“返回键”，移除悬浮窗">点击手机“返回键”，移除悬浮窗</h2><p>在悬浮窗的view类里添加</p>
<pre><code><span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">dispatchKeyEvent</span><span class="params">(KeyEvent event)</span> </span>{ 
    <span class="keyword">switch</span> (event.getKeyCode()) {
    <span class="keyword">case</span> KeyEvent.KEYCODE_BACK:
        MyWindowManager.removeBigWindow(getContext());
    <span class="comment">//  MyWindowManager.createSmallWindow(getContext());</span>
        <span class="keyword">return</span> <span class="keyword">true</span>;
    <span class="keyword">default</span>:
        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchKeyEvent(event); 
    }
}
</code></pre><h2 id="触摸悬浮窗外部区域，移除悬浮窗">触摸悬浮窗外部区域，移除悬浮窗</h2><p>在悬浮窗的view类里添加</p>
<pre><code><span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>{
    <span class="keyword">int</span> x = (<span class="keyword">int</span>) event.getX();
    <span class="keyword">int</span> y = (<span class="keyword">int</span>) event.getY();
    Rect rect = <span class="keyword">new</span> Rect();
    <span class="comment">//getGlobalVisibleRect方法的作用是获取视图在屏幕坐标中的可视区域;</span>
    <span class="comment">//getLocalVisibleRect的作用是获取视图本身可见的坐标区域，坐标以自己的左上角为原点（0，0）</span>
    <span class="keyword">this</span>.getGlobalVisibleRect(rect);
    <span class="keyword">if</span> ( ! rect.contains(x, y) ) {
        MyWindowManager.removeBigWindow(getContext());
    <span class="comment">//  MyWindowManager.createSmallWindow(getContext());</span>
    }
    <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">dispatchTouchEvent</span><span class="params">(event)</span></span>;
}
</code></pre><p>参考：</p>
<ol>
<li><a href="http://www.cnblogs.com/mengdd/p/3824782.html" target="_blank" rel="external">Android悬浮窗实现 使用WindowManager</a></li>
<li><a href="http://www.cnblogs.com/ai-developers/p/4413585.html" target="_blank" rel="external">getGlobalVisibleRect和getLocalVisibleRect</a></li>
</ol>
<h2 id="获取状态栏高度">获取状态栏高度</h2><pre><code><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getStatusBarHeight</span><span class="params">(Context context)</span> </span>{  
    <span class="keyword">if</span> (statusBarHeight == <span class="number">0</span>) {  
        <span class="keyword">try</span> {  
            Class&lt;?&gt; c = Class.forName(<span class="string">"com.android.internal.R$dimen"</span>);  
            Object o = c.newInstance();  
            Field field = c.getField(<span class="string">"status_bar_height"</span>);  
            <span class="keyword">int</span> x = (Integer) field.<span class="keyword">get</span>(o);  
            statusBarHeight = context.getResources().getDimensionPixelSize(x);  
        } <span class="keyword">catch</span> (Exception e) {  
            e.printStackTrace();  
        }  
    }  
    <span class="keyword">return</span> statusBarHeight;  
}
</code></pre><p>参考：<a href="http://blog.csdn.net/guolin_blog/article/details/8689140" target="_blank" rel="external">Android桌面悬浮窗效果实现，仿360手机卫士悬浮窗效果</a></p>
<h2 id="TextView横向自动滚动实现跑马灯效果">TextView横向自动滚动实现跑马灯效果</h2><p>1.原生android自带的跑马灯效果，直接配置TextView属性</p>
<pre><code><span class="label">android:</span>singleLine=<span class="string">"true"</span>  
<span class="label">android:</span>ellipsize=<span class="string">"marquee"</span> 
<span class="label">android:</span>focusable=<span class="string">"true"</span>  
<span class="label">android:</span>focusableInTouchMode=<span class="string">"true"</span> 
<span class="label">android:</span>marqueeRepeatLimit=<span class="string">"marquee_forever"</span>   
</code></pre><ul>
<li>android:singleLine=true 表示使用单行文字，多行文字也就无所谓使用Marquee效果了。</li>
<li>android:marqueeRepeatLimit，设置走马灯滚动的次数。marquee_forever为无限循环。</li>
<li>android:ellipsize，设置了文字过长时如何切断文字，可以有none, start,middle, end, 如果使用走马灯效果则设为marquee.</li>
<li>android:focusable，Android的缺省行为是在控件获得Focus时才会显示走马灯效果</li>
</ul>
<h2 id="判断当前界面是否是桌面">判断当前界面是否是桌面</h2><pre><code>private <span class="type">boolean</span> isHome() {  
    ActivityManager mActivityManager = (ActivityManager) getSystemService(Context.ACTIVITY_SERVICE);  
    List&lt;RunningTaskInfo&gt; rti = mActivityManager.getRunningTasks(<span class="number">1</span>);  
<span class="command">    return</span> getHomes().<span class="keyword">contains</span>(rti.<span class="keyword">get</span>(<span class="number">0</span>).topActivity.getPackageName());  
} 
</code></pre><h2 id="获得属于桌面的应用的应用包名称">获得属于桌面的应用的应用包名称</h2><pre><code>private <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; getHomes() {  
    <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; names = <span class="keyword">new</span> ArrayList&lt;<span class="built_in">String</span>&gt;();  
    PackageManager packageManager = <span class="keyword">this</span>.getPackageManager();  
    Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_MAIN);  
    intent.addCategory(Intent.CATEGORY_HOME);  
    <span class="built_in">List</span>&lt;ResolveInfo&gt; resolveInfo = packageManager.queryIntentActivities(intent,  
            PackageManager.MATCH_DEFAULT_ONLY);  
    <span class="keyword">for</span> (ResolveInfo ri : resolveInfo) {  
        names.add(ri.activityInfo.packageName);  
    }  
    <span class="keyword">return</span> names;  <span class="comment">//返回包含所有包名的字符串列表</span>
}  
</code></pre><p>2015-9-3</p>
<h1 id="PendingIntent">PendingIntent</h1><h2 id="flag">flag</h2><ul>
<li><p><code>0</code>：默认为无论是否存在相同的 PendingIntent 对象都会创建一个新的 PendingIntent。</p>
</li>
<li><p><code>FLAG_CANCEL_CURRENT</code>: 如果当前系统中已经存在一个相同的 PendingIntent 对象，那么就将先将已有的 PendingIntent 取消，然后重新生成一个 PendingIntent 对象。</p>
</li>
<li><p><code>FLAG_NO_CREATE</code>: 如果当前系统中不存在相同的 PendingIntent 对象，系统将不会创建该 PendingIntent 对象而是直接返回 null。</p>
</li>
<li><p><code>FLAG_ONE_SHOT</code>: 该 PendingIntent 只作用一次，如果该 PendingIntent 对象已经触发过一次，那么下次再获取该 PendingIntent 并且再触发时，系统将会返回一个 SendIntentException，在使用这个标志的时候一定要注意哦。</p>
</li>
<li><p><code>FLAG_UPDATE_CURRENT</code>: 如果系统中已存在该 PendingIntent 对象，那么系统将保留该 PendingIntent 对象，但是会使用新的 Intent 来更新之前 PendingIntent 中的 Intent 对象数据，例如更新 Intent 中的 Extras。这个非常有用，例如之前提到的，我们需要在每次更新之后更新 Intent 中的 Extras 数据，达到在不同时机传递给 MainActivity 不同的参数，实现不同的效果。</p>
</li>
</ul>
<p>参考：<br>1.<a href="http://stackoverflow.com/questions/4523349/what-happens-if-you-set-the-flag-on-a-pendingintent-to-0" target="_blank" rel="external">What happens if you set the flag on a PendingIntent to 0?</a><br>2.<a href="http://7dot9.com/?p=333" target="_blank" rel="external">Android PendingIntent 的一些小迷惑</a></p>
<p>2015-9-5</p>
<h1 id="SeekBar拖动条">SeekBar拖动条</h1><h2 id="SeekBar总是自动获取焦点（点击/触摸SeekBar外部区域时，thumb会有响应（变色））">SeekBar总是自动获取焦点（点击/触摸SeekBar外部区域时，thumb会有响应（变色））</h2><p>在<code>.xml</code>中给<seekbar>添加属性：</seekbar></p>
<pre><code><span class="label">android:</span>clickable=<span class="string">"true"</span>
<span class="label">android:</span>focusable=<span class="string">"true"</span>
<span class="label">android:</span>focusableInTouchMode=<span class="string">"true"</span>
</code></pre><h1 id="TextView显示音标">TextView显示音标</h1><p>1.下载音标字体，如TOPhonetic.ttf，将音标字体文件放在<code>assets/font</code>目录下<br>2.为TextView设置属性</p>
<pre><code>Typeface <span class="variable">mFace =</span> Typeface.createFromAsset(getAssets(), <span class="string">"font/TOPhonetic.ttf"</span>); 
wordPhoneticTextView.setTypeface(mFace);
</code></pre><p>若显示<code>getAssets() is undefined</code>，则改为<code>context.getAssets()</code><br>参考：<a href="http://marshal.easymorse.com/index.html%3Fp=4087.html" target="_blank" rel="external">Android如何显示音标</a></p>
<p>2015-9-6</p>
<h1 id="TextView设置不同的字体风格">TextView设置不同的字体风格</h1><p>悬浮窗里只用了一个TextView，便于显示跑马灯效果。为了显示音标使用了TOPhonetic字体，但这样显示的英文和中文都不太喜欢，想只有音标使用TOPhonetic字体，单词和释义跟随手机当前字体。</p>
<h2 id="1-使用Html-fromHtml">1.使用Html.fromHtml</h2><p>如：</p>
<pre><code>mTextView.setTextView(Html.fromHtml("<span class="tag">&lt;<span class="title">font</span> <span class="attribute">color</span>=<span class="value">'red'</span>&gt;</span><span class="tag">&lt;<span class="title">b</span>&gt;</span>" + "红色字体"
            + "<span class="tag">&lt;/<span class="title">b</span>&gt;</span><span class="tag">&lt;/<span class="title">font</span>&gt;</span>TextView学习显示不同颜色"));
</code></pre><p>Textview并不支持所有的html标签。如果更复杂的，可以直接使用webview组件。<br>查找资料有人说<code>&lt;font face=&quot;verdana&quot; color=&quot;green&quot;&gt;This is some text!&lt;/font&gt;</code>，想要更改字体必须手机上安装了此字体。（未测试是否可行，但直接使用的确无效）</p>
<h2 id="String_Resources支持的tag">String Resources支持的tag</h2><pre><code>-<span class="ruby"> &lt;a&gt; (supports attributes <span class="string">"href"</span>)
</span>-<span class="ruby"> &lt;annotation&gt;
</span>-<span class="ruby"> &lt;b&gt;
</span>-<span class="ruby"> &lt;big&gt;
</span>-<span class="ruby"> &lt;font&gt; (supports attributes <span class="string">"height"</span>, <span class="string">"size"</span>, <span class="string">"fgcolor"</span> <span class="keyword">and</span> <span class="string">"bicolor"</span>, as integers)
</span>-<span class="ruby"> &lt;i&gt;
</span>-<span class="ruby"> &lt;li&gt;
</span>-<span class="ruby"> &lt;marquee&gt;
</span>-<span class="ruby"> &lt;small&gt;
</span>-<span class="ruby"> &lt;strike&gt;
</span>-<span class="ruby"> &lt;sub&gt;
</span>-<span class="ruby"> &lt;sup&gt;
</span>-<span class="ruby"> &lt;tt&gt;
</span>-<span class="ruby"> &lt;u&gt;</span>
</code></pre><h2 id="Html-fromHtml()支持的tag">Html.fromHtml()支持的tag</h2><pre><code>-<span class="ruby"> &lt;a&gt; (supports attribute <span class="string">"href"</span>)
</span>-<span class="ruby"> &lt;b&gt;
</span>-<span class="ruby"> &lt;big&gt;
</span>-<span class="ruby"> &lt;blockquote&gt;
</span>-<span class="ruby"> &lt;br&gt;
</span>-<span class="ruby"> &lt;cite&gt;
</span>-<span class="ruby"> &lt;dfn&gt;
</span>-<span class="ruby"> &lt;div&gt;
</span>-<span class="ruby"> &lt;em&gt;
</span>-<span class="ruby"> &lt;font&gt; (supports attributes <span class="string">"color"</span> <span class="keyword">and</span> <span class="string">"face"</span>)
</span>-<span class="ruby"> &lt;i&gt;
</span>-<span class="ruby"> &lt;img&gt; (supports attribute <span class="string">"src"</span>. <span class="constant">Note</span><span class="symbol">:</span> you have to <span class="keyword">include</span> an <span class="constant">ImageGetter</span> to handle retrieving a <span class="constant">Drawable</span> <span class="keyword">for</span> this tag)
</span>-<span class="ruby"> &lt;p&gt;
</span>-<span class="ruby"> &lt;small&gt;
</span>-<span class="ruby"> &lt;strong&gt;
</span>-<span class="ruby"> &lt;sub&gt;
</span>-<span class="ruby"> &lt;sup&gt;
</span>-<span class="ruby"> &lt;tt&gt;
</span>-<span class="ruby"> &lt;u&gt;</span>
</code></pre><h2 id="支持的颜色：">支持的颜色：</h2><pre><code>-<span class="ruby"> aqua
</span>-<span class="ruby"> black
</span>-<span class="ruby"> blue
</span>-<span class="ruby"> fuchsia
</span>-<span class="ruby"> green
</span>-<span class="ruby"> grey
</span>-<span class="ruby"> lime
</span>-<span class="ruby"> maroon
</span>-<span class="ruby"> navy
</span>-<span class="ruby"> olive
</span>-<span class="ruby"> purple
</span>-<span class="ruby"> red
</span>-<span class="ruby"> silver
</span>-<span class="ruby"> teal
</span>-<span class="ruby"> white
</span>-<span class="ruby"> yellow</span>
</code></pre><p>参考：<br>1.<a href="http://daniel-codes.blogspot.kr/2011/04/html-in-textviews.html" target="_blank" rel="external">HTML in TextViews</a><br>2.<a href="http://m.blog.csdn.net/blog/lue2009/46122727" target="_blank" rel="external">Android 字体设置注意的地方</a></p>
<h2 id="2-使用Spannable">2.使用Spannable</h2><p>1.<code>CustomTypefaceSpan</code> Class:</p>
<pre><code><span class="keyword">import</span> android.graphics.Paint;
<span class="keyword">import</span> android.graphics.Typeface;
<span class="keyword">import</span> android.text.TextPaint;
<span class="keyword">import</span> android.text.style.TypefaceSpan;

<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomTypefaceSpan</span> <span class="keyword">extends</span> <span class="title">TypefaceSpan</span> </span>{
    <span class="keyword">private</span> <span class="keyword">final</span> Typeface newType;

    <span class="function"><span class="keyword">public</span> <span class="title">CustomTypefaceSpan</span><span class="params">(String family, Typeface type)</span> </span>{
        <span class="keyword">super</span>(family);
        newType = type;
    }

    <span class="annotation">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateDrawState</span><span class="params">(TextPaint tp)</span> </span>{
        applyCustomTypeFace(tp, newType);
    }

    <span class="annotation">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateMeasureState</span><span class="params">(TextPaint paint)</span> </span>{
        applyCustomTypeFace(paint, newType);
    }

    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">applyCustomTypeFace</span><span class="params">(Paint paint, Typeface tf)</span> </span>{
        <span class="keyword">int</span> oldStyle;
        Typeface old = paint.getTypeface();
        <span class="keyword">if</span> (old == <span class="keyword">null</span>) {
            oldStyle = <span class="number">0</span>;
        } <span class="keyword">else</span> {
            oldStyle = old.getStyle();
        }

        <span class="keyword">int</span> fake = oldStyle &amp; ~tf.getStyle();
        <span class="keyword">if</span> ((fake &amp; Typeface.BOLD) != <span class="number">0</span>) {
            paint.setFakeBoldText(<span class="keyword">true</span>);
        }

        <span class="keyword">if</span> ((fake &amp; Typeface.ITALIC) != <span class="number">0</span>) {
            paint.setTextSkewX(-<span class="number">0.25f</span>);
        }

        paint.setTypeface(tf);
    }
}
</code></pre><p>2.使用方法</p>
<pre><code>Typeface font1 = Typeface.createFromAsset(getAssets(), <span class="string">"font/font1.ttf"</span>);
Typeface font2 = Typeface.createFromAsset(getAssets(), <span class="string">"font/font2.ttf"</span>);   
<span class="keyword">String</span> <span class="built_in">str</span> = <span class="string">"abcdefghijk"</span>;
<span class="built_in">int</span> len = <span class="built_in">str</span>.length();
SpannableStringBuilder ss = <span class="keyword">new</span> SpannableStringBuilder(<span class="built_in">str</span>);
ss.setSpan (<span class="keyword">new</span> CustomTypefaceSpan(<span class="string">""</span>, font1), <span class="number">0</span>, <span class="number">2</span>,Spanned.SPAN_EXCLUSIVE_INCLUSIVE);
ss.setSpan (<span class="keyword">new</span> CustomTypefaceSpan(<span class="string">""</span>, font2), <span class="number">2</span>, <span class="number">5</span>,Spanned.SPAN_EXCLUSIVE_INCLUSIVE);
ss.setSpan (<span class="keyword">new</span> CustomTypefaceSpan(<span class="string">""</span>, Typeface.DEFAULT), <span class="number">5</span>, len,Spanned.SPAN_EXCLUSIVE_INCLUSIVE);
textview.setText(ss);
</code></pre><p>注意：<br><code>setSpan(Object what, int start, int end, int flags)</code>的参数：<br>字符的位置从0开始计数</p>
<ul>
<li><code>int start</code>：开始位置（以0为基数）</li>
<li><code>int end</code>：从start开始一共（end-start）个字符，即实际结束位置为（end-1）</li>
<li><code>int flags</code>：有2个值<code>SPAN_EXCLUSIVE_INCLUSIVE</code>和<code>SPAN_EXCLUSIVE_EXCLUSIVE</code>，使用中没发现有什么区别。O.O</li>
</ul>
<p>参考：<br>1.<a href="http://aichixihongshi.iteye.com/blog/1207503" target="_blank" rel="external">android中用Spannable在TextView中设置超链接、颜色、字体</a><br>2.<a href="http://stackoverflow.com/questions/6612316/how-set-spannable-object-font-with-custom-font" target="_blank" rel="external">How set Spannable object font with custom font</a></p>
<h1 id="“通知栏单词”无法正确显示音标">“通知栏单词”无法正确显示音标</h1><p>可以通过<code>tickerText.setSpan(new StyleSpan(Typeface.BOLD_ITALIC), 0, tickerText.length(), Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</code>设置加粗或斜体，但用自定义<code>CustomTypefaceSpan</code>时无效。未找到解决办法。<br>最后发现，其实手机是可以直接显示音标的。。（直接复制音标比如<code>setTicker(&quot;[əˈsɪst]&quot;)</code>，手机上可以正常显示！！！）<br>看来是源数据的编码问题@_@<br>又找了几份单词excel文件，终于找到个可以正常显示的了。<a href="http://bbs.kaoyan.com/forum.php?mod=viewthread&amp;tid=3658574&amp;page=1" target="_blank" rel="external">下载单词音标释义版excel</a><br>换了数据后，一切正常显示。。也不用替换字体了~</p>
<h1 id="SQLite数据库">SQLite数据库</h1><p>记得之前有做笔记的，但是竟然找不到了。。<br>以前在实习公司用过Navicat，但是启动特别缓慢（现在看来是电脑问题<code>—_—</code>），加上网上也有人说Navicat臃肿然后推荐了一堆别的软件，今天之前都用的SQLiteStudio，实话说，不太好用。刚刚新的excel文件虽然在excel里音标是正常的，但导出到txt音标又乱码了，更换字体无效！！！于是只好安装Navicat，可以直接导入excel数据，发现在我的电脑并不卡<code>—_—</code>果断弃用SQLiteStudio。所以这么曲折都是为什么。。。</p>
<p>2015-9-7</p>
<h2 id="Navicat对SQLite添加时间字段">Navicat对SQLite添加时间字段</h2><p>新增时间字段，类型选择<code>TEXT</code>，在下方<code>默认</code>栏里写<code>(datetime(&#39;now&#39;,&#39;localtime&#39;))</code> （注意最外要有括号），即可自动添加当前时区的时间。若<code>默认</code>为<code>CURRENT_TIMESTAMP</code>，则时区为GMT。<br>参考：<br>1.<a href="http://stackoverflow.com/questions/200309/sqlite-database-default-time-value-now" target="_blank" rel="external">sqlite database default time value ‘now’</a><br>2.<a href="http://stackoverflow.com/questions/381371/sqlite-current-timestamp-is-in-gmt-not-the-timezone-of-the-machine" target="_blank" rel="external">Sqlite: CURRENT_TIMESTAMP is in GMT, not the timezone of the machine</a><br>3.<a href="https://community.navicat.com/forum/navicat-product/navicat-for-sqlite/1075-how-to-enter-function-values-in-tables" target="_blank" rel="external">How to enter function values in tables ?</a></p>
<h1 id="Button的点击和父控件的冲突">Button的点击和父控件的冲突</h1><p>1.在“悬浮窗单词”SmallFloatWindowView中，一个Button用来播放单词读音，一个TextView显示单词。<br>最初是对“悬浮窗单词”的SmallFloatWindowView进行onTouchEvent监听，对Button进行OnClickListener监听，但这样Button无法移动，Textview可以移动。<br>改为：button.setOnTouchListener监听onTouch行为，在onTouch里执行button的操作。<br>2.虽然解决了问题，但2个监听有很多重复代码，只是处理点击有所不同。<br>将两者都设置setOnTouchListener，复写onTouch</p>
<pre><code><span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent ev)</span> </span>{
    <span class="keyword">switch</span> (ev.getAction()) {  
    <span class="keyword">case</span> MotionEvent.ACTION_DOWN:  
        xInView = ev.getX();  
        yInView = ev.getY();  
        xDownInScreen = ev.getRawX();  
        yDownInScreen = ev.getRawY();  
        xInScreen = ev.getRawX();  
        yInScreen = ev.getRawY();  
        <span class="keyword">break</span>;  
    <span class="keyword">case</span> MotionEvent.ACTION_MOVE:  
        xInScreen = ev.getRawX();  
        yInScreen = ev.getRawY();  
        updateViewPosition();  
        <span class="keyword">break</span>;  
    <span class="keyword">case</span> MotionEvent.ACTION_UP:  
        <span class="keyword">if</span> (xDownInScreen == xInScreen &amp;&amp; yDownInScreen == yInScreen) {
            <span class="keyword">switch</span> (v.getId()) {
            <span class="keyword">case</span> R.id.small_float_window_layout:
                Log.d(VIEW_LOG_TAG, <span class="string">"点击了float window"</span>);
                <span class="keyword">break</span>;
            <span class="keyword">case</span> R.id.small_float_window_play_btn:
                Log.d(VIEW_LOG_TAG, <span class="string">"点击了btn"</span>);
                <span class="keyword">break</span>;
            <span class="keyword">default</span>:
                <span class="keyword">break</span>;
            }
        }  
        <span class="keyword">break</span>;  
    <span class="keyword">default</span>:  
        <span class="keyword">break</span>;  
    }
    <span class="keyword">return</span> <span class="keyword">true</span>;
}  
</code></pre><p>注意：最后要返回true，否则只能监听到btn的行为。<br>参考：<a href="http://stackoverflow.com/questions/6924275/motionevent-action-up-on-textview" target="_blank" rel="external">MotionEvent.ACTION_UP on Textview</a></p>
<p>2015-9-8</p>
<h1 id="RecyclerView添加PopMenu菜单">RecyclerView添加PopMenu菜单</h1><p>在ViewHolder里配置：<br>1.setOnClickListener</p>
<pre><code><span class="function"><span class="keyword">public</span> <span class="title">ViewHolder</span><span class="params">( View v )</span> </span>{  
        <span class="keyword">super</span>(v);  
        <span class="keyword">this</span>.view = v;
        v.setOnLongClickListener(<span class="keyword">this</span>);
} 
</code></pre><p>2.在OnLongClickListener创建PopupMenu</p>
<pre><code><span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onLongClick</span><span class="params">(View v)</span> </span>{
    <span class="keyword">if</span> ( v == <span class="keyword">this</span>.view ) {
        PopupMenu popMenu = <span class="keyword">new</span> PopupMenu(v.getContext(), v);
        popMenu.inflate(R.menu.wordbook_context_menu);
        popMenu.setOnMenuItemClickListener(<span class="keyword">this</span>);
        popMenu.show();
    }
    <span class="keyword">return</span> <span class="keyword">false</span>;
}
</code></pre><p>3.在OnMenuItemClickListener给menu items添加操作</p>
<pre><code><span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onMenuItemClick</span><span class="params">(MenuItem item)</span> </span>{
    <span class="keyword">switch</span> (item.getItemId()) {
    <span class="keyword">case</span> R.id.wordbook_context_menu_edit:
        Toast.makeText(view.getContext(),tvWord.getText().toString()+item.getTitle(), Toast.LENGTH_SHORT).show();
        <span class="keyword">break</span>;
    <span class="keyword">case</span> R.id.wordbook_context_menu_delete:
        Toast.makeText(view.getContext(),tvWord.getText().toString()+item.getTitle(), Toast.LENGTH_SHORT).show();
        <span class="keyword">break</span>;
    <span class="keyword">case</span> R.id.wordbook_context_menu_addto:
        Toast.makeText(view.getContext(),tvWord.getText().toString()+item.getTitle(), Toast.LENGTH_SHORT).show();
        <span class="keyword">break</span>;
    <span class="keyword">default</span>:
        <span class="keyword">break</span>;
    }
    <span class="keyword">return</span> <span class="keyword">true</span>;
}
</code></pre><p>参考：<a href="http://lenz-tech.blogspot.kr/2015/05/adding-context-menus-to-recyclerview.html" target="_blank" rel="external">Adding context menus to RecyclerView items</a></p>
<p>2015-9-9</p>
<h1 id="SQLite数据库-1">SQLite数据库</h1><h2 id="获取所有表名">获取所有表名</h2><pre><code>db = wordsDbHelper.getReadableDatabase();
List&lt;<span class="keyword">String</span>&gt; tableList = <span class="keyword">new</span> ArrayList&lt;<span class="keyword">String</span>&gt;();
Cursor <span class="built_in">cursor</span> = db.rawQuery(<span class="string">"SELECT name FROM sqlite_master WHERE type='table' AND name!='android_metadata' order by name"</span>, <span class="keyword">null</span>);
<span class="keyword">while</span>(<span class="built_in">cursor</span>.moveToNext()){
    tableList.<span class="built_in">add</span>(<span class="built_in">cursor</span>.getString(<span class="number">0</span>));
}
</code></pre><p>参考：<a href="http://stackoverflow.com/questions/26323913/how-to-select-all-tables-names-instead-android-metadata-android-sqlite" target="_blank" rel="external">How to select all tables names instead android_metadata android SQLite</a></p>
<h2 id="表重命名">表重命名</h2><pre><code><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> alterTableName(<span class="keyword">String</span> oldName, <span class="keyword">String</span> newName) {
    <span class="keyword">if</span> ( ! getTableList().contains(newName) ) {
        db = wordsDbHelper.getReadableDatabase();
        db.execSQL(<span class="string">"ALTER TABLE "</span> + oldName + <span class="string">" RENAME TO "</span> + newName + <span class="string">";"</span>);
        db.close();
    }
}
</code></pre><h1 id="RecyclerView详细使用">RecyclerView详细使用</h1><p>参考：<a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2014/1118/2004.html" target="_blank" rel="external">RecyclerView使用介绍</a></p>
<h2 id="RecyclerView_Adapter更新数据集">RecyclerView Adapter更新数据集</h2><pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">updateList</span><span class="params">(List&lt;WordCls&gt; newList)</span> </span>{
    <span class="keyword">this</span>.wordsList = newList;
    notifyDataSetChanged();
}
</code></pre><h1 id="AlertDialog对话框">AlertDialog对话框</h1><p>参考：<a href="http://www.imyukin.com/?p=236" target="_blank" rel="external">Android的AlertDialog详解</a></p>
<p>2015-9-10</p>
<h1 id="RecyclerView添加点击事件，并获取item_position">RecyclerView添加点击事件，并获取item position</h1><p>参考：<br>1.<a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2014/1118/2004.html" target="_blank" rel="external">RecyclerView使用介绍</a><br>2.<a href="https://gist.github.com/riyazMuhammad/1c7b1f9fa3065aa5a46f" target="_blank" rel="external">Easy Implementation of RecyclerView custom onItemClickListener</a></p>
<h1 id="RecyclerView水平滑动类似viewpager——继承SnappingRecyclerView">RecyclerView水平滑动类似viewpager——继承SnappingRecyclerView</h1><p>参考：<br>1.<a href="https://gist.github.com/lauw/fc84f7d04f8c54e56d56" target="_blank" rel="external">SnappingRecyclerView.java</a><br>2.<a href="http://stackoverflow.com/questions/26370289/snappy-scrolling-in-recyclerview" target="_blank" rel="external">Snappy scrolling in RecyclerView</a></p>
<h1 id="RecyclerView-Adapter根据viewType动态加载不同的item布局">RecyclerView.Adapter根据viewType动态加载不同的item布局</h1><p>在Adapter里<br>1.设置viewType</p>
<pre><code><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_VIEW_VERTICAL = <span class="number">0</span>;
<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_VIEW_HORIZON = <span class="number">1</span>;

<span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">getItemViewType</span><span class="params">(<span class="keyword">int</span> position)</span> </span>{
    <span class="comment">//也可以根据item的position设置不同的viewType</span>
    <span class="keyword">return</span> viewType;
}

<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setItemViewType</span><span class="params">(<span class="keyword">int</span> viewType)</span> </span>{
    <span class="keyword">this</span>.viewType = viewType;
}
</code></pre><p>2.一个item布局对应一个ViewHolder<br>自定义一个<code>BaseViewHolder</code>，让所有的<code>ViewHolder</code>继承它。</p>
<pre><code>public <span class="class"><span class="keyword">class</span> <span class="title">BaseViewHolder</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> {</span>
    public <span class="type">TextView</span> tvWord;  
    public <span class="type">TextView</span> tvPhonetic;  
    public <span class="type">TextView</span> tvDefinition;  

    public <span class="type">BaseViewHolder</span>(<span class="type">View</span> v) {
        <span class="keyword">super</span>(v);
    }
}

public <span class="class"><span class="keyword">class</span> <span class="title">VerticalViewHolder</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">BaseViewHolder</span> {</span>
    public <span class="type">ImageButton</span> imgBtn;

    public <span class="type">VerticalViewHolder</span>( <span class="type">View</span> v) {  
        <span class="keyword">super</span>(v); 

        tvWord = (<span class="type">TextView</span>) v.findViewById(<span class="type">R</span>.id.wordcard_vertical_tv_word);  
        tvPhonetic = (<span class="type">TextView</span>) v.findViewById(<span class="type">R</span>.id.wordcard_vertical_tv_phonetic);  
        tvDefinition = (<span class="type">TextView</span>) v.findViewById(<span class="type">R</span>.id.wordcard_vertical_tv_definition);  
        imgBtn = (<span class="type">ImageButton</span>) v.findViewById(<span class="type">R</span>.id.wordcard_vertical_imgbtn);  
    }
}  

public <span class="class"><span class="keyword">class</span> <span class="title">HorizonViewHolder</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">BaseViewHolder</span> {</span>

    public <span class="type">HorizonViewHolder</span>( <span class="type">View</span> v) {  
        <span class="keyword">super</span>(v); 

        tvWord = (<span class="type">TextView</span>) v.findViewById(<span class="type">R</span>.id.wordcard_horizon_tv_word);  
        tvPhonetic = (<span class="type">TextView</span>) v.findViewById(<span class="type">R</span>.id.wordcard_horizon_tv_phonetic);  
        tvDefinition = (<span class="type">TextView</span>) v.findViewById(<span class="type">R</span>.id.wordcard_horizon_tv_definition);  
    }
}
</code></pre><p>3.根据viewType执行不同的操作</p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordRecyclerViewAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">WordRecyclerViewAdapter</span>.**<span class="title">BaseViewHolder</span>**&gt; </span>{
    ……

    <span class="annotation">@Override</span>  
    <span class="keyword">public</span> **BaseViewHolder** onCreateViewHolder( ViewGroup parent, <span class="keyword">int</span> **viewType** )  
    {  
        <span class="keyword">final</span> **BaseViewHolder** viewHolder;
        View v ;

        <span class="keyword">switch</span> (**viewType**) {
        <span class="keyword">case</span> TYPE_VIEW_HORIZON:
            v = LayoutInflater.from(parent.getContext()).inflate(R.layout.wordbook_item_horizontal_cardview, parent, <span class="keyword">false</span>);  
            viewHolder = <span class="keyword">new</span> HorizonViewHolder(v);
            <span class="keyword">break</span>;
        <span class="keyword">case</span> TYPE_VIEW_VERTICAL:
        <span class="keyword">default</span>:
            v = LayoutInflater.from(parent.getContext()).inflate(R.layout.wordbook_item_vertical_cardview, parent, <span class="keyword">false</span>);  
            viewHolder = <span class="keyword">new</span> VerticalViewHolder(v);
            <span class="keyword">break</span>;
        }

        <span class="keyword">return</span> viewHolder;   
    }

    <span class="annotation">@Override</span>  
    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">( **BaseViewHolder** baseViewHolder, <span class="keyword">int</span> position )</span> </span>{  
        WordCls wordCls = wordsList.get(position);  

        baseViewHolder.itemView.setTag(wordCls);

        baseViewHolder.tvWord.setText(wordCls.getWord());  
        baseViewHolder.tvPhonetic.setText(wordCls.getPhonetic());  
        baseViewHolder.tvDefinition.setText(wordCls.getDefinition());  

        <span class="keyword">switch</span> (**baseViewHolder.getItemViewType()**) {
        <span class="keyword">case</span> TYPE_VIEW_HORIZON:
            HorizonViewHolder horizonViewHolder = (HorizonViewHolder) baseViewHolder;
            ……
            <span class="keyword">break</span>;
        <span class="keyword">case</span> TYPE_VIEW_VERTICAL:
        <span class="keyword">default</span>:
            VerticalViewHolder verticalViewHolder = (VerticalViewHolder) baseViewHolder;
            verticalViewHolder.imgBtn.setOnClickListener(<span class="keyword">new</span> OnClickListener() {

                <span class="annotation">@Override</span>
                <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>{
                }
            });
            ……
            <span class="keyword">break</span>;
        }
    }  
}
</code></pre><p>参考：<br>1.<a href="http://stackoverflow.com/questions/29579717/how-to-change-the-viewtype-of-a-recyclerview-item-onclick" target="_blank" rel="external">How to Change the viewType of a RecyclerView item onClick</a><br>2.<a href="http://stackoverflow.com/a/32267521/5315255" target="_blank" rel="external">Recyclerview and handling different type of row inflation</a></p>
<p>2015-9-11</p>
<h1 id="保存和恢复RecyclerView（Scroll）的精确滑动位置">保存和恢复RecyclerView（Scroll）的精确滑动位置</h1><p>1.scrollby</p>
<pre><code><span class="keyword">private</span> <span class="keyword">int</span> mScrollY;
<span class="keyword">private</span> <span class="keyword">int</span> mScrollYState;
<span class="comment">//保存</span>
<span class="keyword">private</span> RecyclerView.OnScrollListener mTotalScrollListener = <span class="keyword">new</span> RecyclerView.OnScrollListener() {
    <span class="annotation">@Override</span>
    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onScrolled</span><span class="params">(RecyclerView recyclerView, <span class="keyword">int</span> dx, <span class="keyword">int</span> dy)</span> </span>{
        <span class="keyword">super</span>.onScrolled(recyclerView, dx, dy);
        mScrollY += dy;
    }
};
<span class="comment">//恢复</span>
mScrollYState = mScrollY;
mRecyclerView.scrollBy(<span class="number">0</span>, mScrollYState);
</code></pre><p>参考：<a href="http://stackoverflow.com/a/30195360/5315255" target="_blank" rel="external">Refreshing data in RecyclerView and keeping its scroll position</a></p>
<p>2.onSaveInstanceState</p>
<pre><code><span class="constant">Parcelable recyclerViewState</span> = recyclerView.getLayoutManager().onSaveInstanceState();<span class="comment">//保存</span>
recyclerView.getLayoutManager().onRestoreInstanceState(recyclerViewState);<span class="comment">//恢复</span>
</code></pre><p>直接存储RecyclerView的InstanceState，但只能在fragment的生命周期里使用<br>参考：</p>
<ul>
<li>1.<a href="http://stackoverflow.com/a/5688490/5315255" target="_blank" rel="external">Maintain/Save/Restore scroll position when returning to a ListView</a></li>
<li>2.<a href="http://panavtec.me/retain-restore-recycler-view-scroll-position/" target="_blank" rel="external">Retain &amp; restore recycler view scroll position</a></li>
</ul>
<p>2015-9-15<br>3.#保存和恢复RecyclerView（Scroll）的精确滑动位置——改进版<br>尝试了好几天，终于想到了一种比较好的方式，能保存精确位置至本地，随意切换列表数据也能恢复相应表的浏览位置，不过还是有一点点缺陷，第一页的item会跳动一下。</p>
<ul>
<li><p><code>scrollToPosition</code>是根据你的操作方向来判断目标item是显示在顶端还是显示在底端的，手指上滑则显示在底端，手指下滑则显示在顶端。那么在切换列表时，则是根据现在的<code>currentPosition</code>和<code>scrollToPosition(position)</code>的<code>position</code>来判断滑动方向的。这样需要记录顶端和底端的2个偏移量。</p>
</li>
<li><p>切换列表时，是先计算好要滑动的位置，才会显示视图的，所以只能根据当前列表（切换前显示的列表）的视图来计算位置，切换后才会滑到正确的位置。即<code>scrollToPosition</code>会滑到顶端还是底端要靠你自己判断的。</p>
</li>
<li><p>RecyclerView的界面还未出现时，比如第一次打开fragment或者切换到新的数据列表时，<code>findFirstVisibleItemPosition</code>的值是-1，这时是无法获得child View的。调试时发现，只有当手机上能看到RecyclerView时，才能获取child view。并且<code>getChildAt(int index)</code>中的<code>index</code>是指child在当前RecyclerView视图中显示的item个数中的index，而不是针对整个dataset的，故只能获取到正在显示的某一个child的View。</p>
</li>
<li><p>若切换时<code>currentFirstVisiblePosition &lt; savedFirstVisiblePosition</code>，即RecyclerView需要将列表往上拉（手指上滑）以显示下面position较大的部分，<code>scrollToPosition</code>会显示在底端。<br>但是当<code>savedFirstVisiblePosition</code>在其<code>dataset</code>中的位置在手机中显示是在第一页时，<code>scrollToPosition</code>是无法滑动到底端的。我想到的是<code>scrollToPosition</code>后，让列表<code>scrollBy(0, recyclerView.getHeight());</code>往上滑一部分，再<code>scrollToPosition();</code>回来，这样目标item就会显示在顶端了，再用<code>smoothScrollBy(0, dyTop);</code>就可以了。这里最后一步没有用<code>scrollBy</code>是因为没有效，我也不知道为什么，可能不支持连续滑动多次吧，也可以将<code>scrollBy</code>放在handler里，效果和<code>smoothScrollBy</code>差不多；但是这2种方法都会出现跳动的动画。</p>
</li>
</ul>
<pre><code><span class="keyword">private</span> <span class="function"><span class="keyword">void</span> <span class="title">saveRecyclerViewPosition</span><span class="params">(String tableName)</span> </span>{
    firstVisibleItemPosition = ((LinearLayoutManager)recyclerView.getLayoutManager()).findFirstVisibleItemPosition();

    savedFirstVisibleChild = recyclerView.getChildAt(<span class="number">0</span>);
    <span class="comment">//dy正，手指将列表往上拉</span>
    <span class="comment">//dy负，手指将列表往下拉</span>
    dyTop = savedFirstVisibleChild.getHeight() - savedFirstVisibleChild.getBottom(); 
    dyBottom = recyclerView.getHeight() - savedFirstVisibleChild.getBottom();

    prefEditorSettings.putInt(KEY_RECYCLERVIEW_SCROLL_POSITION + tableName, firstVisibleItemPosition);
    prefEditorSettings.putInt(KEY_RECYCLERVIEW_SCROLL_DY_TOP + tableName, dyTop);
    prefEditorSettings.putInt(KEY_RECYCLERVIEW_SCROLL_DY_BOTTOM + tableName, dyBottom);
    prefEditorSettings.commit(); 
}

<span class="keyword">private</span> <span class="function"><span class="keyword">void</span> <span class="title">restoreRecyclerViewPosition</span><span class="params">(String tableName)</span> </span>{
    <span class="keyword">if</span> ( recyclerView != <span class="keyword">null</span>) {
        savedFirstVisiblePosition = prefSettings.getInt(KEY_RECYCLERVIEW_SCROLL_POSITION + tableName, <span class="number">0</span>);
        dyTop = prefSettings.getInt(KEY_RECYCLERVIEW_SCROLL_DY_TOP + tableName, <span class="number">0</span>);
        dyBottom = prefSettings.getInt(KEY_RECYCLERVIEW_SCROLL_DY_BOTTOM + tableName, <span class="number">0</span>);

        currentFirstVisiblePosition =  ((LinearLayoutManager)recyclerView.getLayoutManager()).findFirstVisibleItemPosition();

        recyclerView.scrollToPosition(savedFirstVisiblePosition);

        <span class="keyword">if</span>(currentFirstVisiblePosition &gt; -<span class="number">1</span>) {  
            <span class="keyword">if</span> (currentFirstVisiblePosition &gt;= savedFirstVisiblePosition) { <span class="comment">//savedFirstVisiblePosition在顶部</span>
                recyclerView.scrollBy(<span class="number">0</span>, dyTop);
            } <span class="function"><span class="keyword">else</span> <span class="title">if</span> <span class="params">(currentFirstVisiblePosition &lt; savedFirstVisiblePosition)</span></span>{    <span class="comment">//savedFirstVisiblePosition在底部</span>
                <span class="keyword">if</span> (savedFirstVisiblePosition &gt; <span class="number">4</span>)
                    recyclerView.scrollBy(<span class="number">0</span>, dyBottom);             
                <span class="keyword">else</span> {  <span class="comment">//第一页的item用handler/smoothScrollBy会有跳转动作显示，暂时会找到合适的办法</span>
                    recyclerView.scrollBy(<span class="number">0</span>, recyclerView.getHeight());
                    recyclerView.scrollToPosition(savedFirstVisiblePosition);
                    recyclerView.smoothScrollBy(<span class="number">0</span>, dyTop);
                }
            } 
        } <span class="keyword">else</span> {    <span class="comment">//第一次打开，还未出现界面</span>
            recyclerView.scrollToPosition(savedFirstVisiblePosition);
            recyclerView.scrollBy(<span class="number">0</span>, dyTop);
        }
    }
}
</code></pre><ul>
<li><p>这个方法不受生命周期的限制，但在上述情况中视觉体验不太好，所以可以跟方法2结合起来使用。</p>
<p>  private void saveRecyclerViewPosition(String tableName) {</p>
<pre><code><span class="constant">recyclerViewState</span> = recyclerView.getLayoutManager().onSaveInstanceState();
hmRecyclerViewState.put(tableName, recyclerViewState);

<span class="constant">firstVisibleItemPosition</span> = ((LinearLayoutManager)recyclerView.getLayoutManager()).findFirstVisibleItemPosition();

<span class="constant">savedFirstVisibleChild</span> = recyclerView.getChildAt(0);
//dy正，手指将列表往上拉
//dy负，手指将列表往下拉
<span class="constant">dyTop</span> = savedFirstVisibleChild.getHeight() - savedFirstVisibleChild.getBottom(); 
<span class="constant">dyBottom</span> = recyclerView.getHeight() - savedFirstVisibleChild.getBottom();

prefEditorSettings.putInt(KEY_RECYCLERVIEW_SCROLL_POSITION + tableName, firstVisibleItemPosition);
prefEditorSettings.putInt(KEY_RECYCLERVIEW_SCROLL_DY_TOP + tableName, dyTop);
prefEditorSettings.putInt(KEY_RECYCLERVIEW_SCROLL_DY_BOTTOM + tableName, dyBottom);
prefEditorSettings.commit();
</code></pre><p>  }</p>
<p>  private void restoreRecyclerViewPosition(String tableName) {</p>
<pre><code>recyclerViewState = hmRecyclerViewState.<span class="keyword">get</span>(tableName);
<span class="keyword">if</span> (recyclerViewState != <span class="literal">null</span>) {
    recyclerView.getLayoutManager().onRestoreInstanceState(recyclerViewState);
} <span class="keyword">else</span> {
    <span class="keyword">if</span> ( recyclerView != <span class="literal">null</span>) {
        savedFirstVisiblePosition = prefSettings.getInt(KEY_RECYCLERVIEW_SCROLL_POSITION + tableName, <span class="number">0</span>);
        dyTop = prefSettings.getInt(KEY_RECYCLERVIEW_SCROLL_DY_TOP + tableName, <span class="number">0</span>);
        dyBottom = prefSettings.getInt(KEY_RECYCLERVIEW_SCROLL_DY_BOTTOM + tableName, <span class="number">0</span>);

        currentFirstVisiblePosition =  ((LinearLayoutManager)recyclerView.getLayoutManager()).findFirstVisibleItemPosition();

        recyclerView.scrollToPosition(savedFirstVisiblePosition);

        <span class="keyword">if</span>(currentFirstVisiblePosition &gt; -<span class="number">1</span>) {
            <span class="keyword">if</span> (currentFirstVisiblePosition &gt;= savedFirstVisiblePosition) { <span class="comment">//savedFirstVisiblePosition在顶部</span>
                recyclerView.scrollBy(<span class="number">0</span>, dyTop);
            } <span class="keyword">else</span> <span class="keyword">if</span> (currentFirstVisiblePosition &lt; savedFirstVisiblePosition){    <span class="comment">//savedFirstVisiblePosition在底部</span>
                <span class="keyword">if</span> (savedFirstVisiblePosition &gt; <span class="number">4</span>)
                    recyclerView.scrollBy(<span class="number">0</span>, dyBottom);             
                <span class="keyword">else</span> {  <span class="comment">//第一页的item用handler/smoothScrollBy会有跳转动作显示，暂时会找到合适的办法</span>
                    recyclerView.scrollBy(<span class="number">0</span>, recyclerView.getHeight());
                    recyclerView.scrollToPosition(savedFirstVisiblePosition);
                    recyclerView.smoothScrollBy(<span class="number">0</span>, dyTop);
                }
            } 
        } <span class="keyword">else</span> {    <span class="comment">//第一次打开，还未出现界面</span>
            recyclerView.scrollToPosition(savedFirstVisiblePosition);
            recyclerView.scrollBy(<span class="number">0</span>, dyTop);
        }
    }
}
</code></pre><p>  }</p>
</li>
</ul>
<h1 id="slidingmenu切换fragment时的优化">slidingmenu切换fragment时的优化</h1><p>避免每次切换fragment时都重新加载view。<br>注意：一个activity只有一个actionbar。</p>
<p>1.<code>SlidingmenuFragment</code></p>
<pre><code>@<span class="function">Override
<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onListItemClick</span><span class="params">(ListView lv, View v, <span class="keyword">int</span> position, <span class="keyword">long</span> id)</span> </span>{
    newContentFragment = <span class="keyword">null</span>;

    <span class="keyword">object</span> = lv.getItemAtPosition(position);
    str=(String)<span class="keyword">object</span>;

    getActivity().setTitle(str);
    actionBar.setDisplayShowCustomEnabled(<span class="keyword">false</span>);

    <span class="keyword">if</span> (str.matches(getResources().getString(R.<span class="keyword">string</span>.center))){
        <span class="keyword">if</span> (centerFragment == <span class="keyword">null</span>)
            centerFragment = <span class="keyword">new</span> CenterFragment();
        newContentFragment = centerFragment;
    } <span class="function"><span class="keyword">else</span> <span class="title">if</span> <span class="params">(str.matches(getResources()</span>.<span class="title">getString</span><span class="params">(R.<span class="keyword">string</span>.home)</span>))</span>{
        <span class="keyword">if</span> (homeFragment == <span class="keyword">null</span>)
            homeFragment = <span class="keyword">new</span> HomeFragment(getActivity());
        newContentFragment = homeFragment;
    } <span class="function"><span class="keyword">else</span> <span class="title">if</span> <span class="params">(str.matches(getResources()</span>.<span class="title">getString</span><span class="params">(R.<span class="keyword">string</span>.wordbook)</span>))</span>{
        <span class="keyword">if</span> (wordBookFragment == <span class="keyword">null</span>)
            wordBookFragment = <span class="keyword">new</span> WordBookFragment();
        newContentFragment = wordBookFragment;
        <span class="comment">//加载自定义actionbar布局，在wordBookFragment里实现actionBar.setCustomView()后，在这里设置为true即可。</span>
        actionBar.setDisplayShowCustomEnabled(<span class="keyword">true</span>);
    } <span class="function"><span class="keyword">else</span> <span class="title">if</span> <span class="params">(str.matches(getResources()</span>.<span class="title">getString</span><span class="params">(R.<span class="keyword">string</span>.BBS)</span>))</span>{
        <span class="keyword">if</span> (bbsFragment == <span class="keyword">null</span>)
            bbsFragment = <span class="keyword">new</span> BBSFragment();
        newContentFragment = bbsFragment;
    } <span class="function"><span class="keyword">else</span> <span class="title">if</span> <span class="params">(str.matches(getResources()</span>.<span class="title">getString</span><span class="params">(R.<span class="keyword">string</span>.settings)</span>))</span>{
        <span class="keyword">if</span> (settingsFragment == <span class="keyword">null</span>)
            settingsFragment = <span class="keyword">new</span> SettingsFragment();
        newContentFragment = settingsFragment;
    }


    <span class="keyword">if</span> (newContentFragment != <span class="keyword">null</span>){
        switchFragment(newContentFragment);
    }
}

<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">switchFragment</span><span class="params">(Fragment fragment)</span> </span>{
    <span class="keyword">if</span> (getActivity() == <span class="keyword">null</span>)
        <span class="keyword">return</span>;

    <span class="keyword">if</span> (getActivity() instanceof MainActivity) {
        MainActivity main = (MainActivity) getActivity();
        main.switchContent(fragment);
    } 
}
</code></pre><p>2.<code>MainActivity</code></p>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">switchContent</span><span class="params">(Fragment newFragment)</span> </span>{
    <span class="keyword">if</span> ( contentFragment == <span class="keyword">null</span> || newFragment == <span class="keyword">null</span>)
        <span class="keyword">return</span>;

    FragmentTransaction transaction = getFragmentManager().beginTransaction();

    <span class="keyword">if</span> (contentFragment != newFragment) {
        <span class="keyword">if</span> (!newFragment.isAdded()) {
            <span class="comment">// 隐藏当前的fragment，add下一个到Activity中</span>
            transaction.hide(contentFragment).add(R.id.content_frame,newFragment).commit();
        } <span class="keyword">else</span> {
           <span class="comment">// 隐藏当前的fragment，显示下一个</span>
            transaction.hide(contentFragment).show(newFragment).commit();
        }
        contentFragment = newFragment;
    }

    <span class="comment">//通过handler来避免滑动卡顿的情况</span>
    <span class="keyword">handler</span>.post(<span class="keyword">new</span> Runnable() {

        <span class="annotation">@Override</span>
        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{
            sm.showContent();
        }
    });
}
</code></pre><p>参考：</p>
<ul>
<li>1.<a href="http://m.blog.csdn.net/blog/u011677471/42970339" target="_blank" rel="external">Android SlidingMenu Fragment的简单优化</a></li>
<li>2.<a href="http://bbs.csdn.net/topics/390767905" target="_blank" rel="external">SlidingMenu 左侧菜单切换</a></li>
<li>3.<a href="http://blog.csdn.net/csr_yang/article/details/33502141" target="_blank" rel="external">slidingmenu+fragment实现常用的侧滑效果（包括Fragment状态的保存）</a></li>
<li>4.<a href="http://blog.csdn.net/telenewbie/article/details/45486657" target="_blank" rel="external">SlidingMenu切换fragment卡顿问题</a></li>
</ul>
<p>2015-9-16</p>
<h1 id="联网解析JSON数据">联网解析JSON数据</h1><p>本来想用金山的，但一直没收到key，发现扇贝的查单词不用key，就用了<a href="http://www.shanbay.com/developer/wiki/api_v1/#query_word" target="_blank" rel="external">扇贝的API</a>。<br>1.在AsyncTask里联网并解析数据</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">ParseJsonTask</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">String</span>, <span class="title">Void</span>, <span class="title">Boolean</span>&gt; </span>{
    HorizonViewHolder horizonViewHolder;
    WordCls wordCls;
    <span class="keyword">int</span> position;

    String definitionEN;
    String definitionCN;
    String audioUrlUS;

    Handler <span class="keyword">handler</span>;    <span class="comment">//用来传值</span>

    <span class="function"><span class="keyword">public</span> <span class="title">ParseJsonTask</span><span class="params">(HorizonViewHolder horizonViewHolder,
            WordCls wordCls, <span class="keyword">int</span> position, Handler <span class="keyword">handler</span>)</span> </span>{
        <span class="keyword">super</span>();
        <span class="keyword">this</span>.horizonViewHolder = horizonViewHolder;
        <span class="keyword">this</span>.wordCls = wordCls;
        <span class="keyword">this</span>.position = position;
        <span class="keyword">this</span>.<span class="keyword">handler</span> = <span class="keyword">handler</span>;
    }

    <span class="annotation">@Override</span>
    <span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onPreExecute</span><span class="params">()</span> </span>{
        horizonViewHolder.progressBar.setVisibility(View.VISIBLE);
        <span class="keyword">super</span>.onPreExecute();
    }

    <span class="annotation">@Override</span>
    <span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onPostExecute</span><span class="params">(Boolean result)</span> </span>{
        Message msg = <span class="keyword">handler</span>.obtainMessage();

        horizonViewHolder.progressBar.setVisibility(View.INVISIBLE);
        <span class="keyword">if</span> (result) {
            wordCls.setDefinitionEN(definitionEN);
            wordCls.setDefinitionCN(definitionCN);
            wordCls.setAudioUrlUS(audioUrlUS);
            wordCls.setLoaded(<span class="keyword">true</span>);
            WordsManager.addWordLoadInfo(tableName, wordCls);
            updateItem(position, wordCls);

            msg.what = position;
        }<span class="keyword">else</span> {
            msg.what = <span class="number">0</span>;
            Log.i(wordCls.getWord(), <span class="string">"获取数据失败"</span>);
        }

        <span class="keyword">handler</span>.sendMessage(msg);

        <span class="keyword">super</span>.onPostExecute(result);
    }

    <span class="annotation">@Override</span>
    <span class="keyword">protected</span> <span class="function">Boolean <span class="title">doInBackground</span><span class="params">(String... params)</span> </span>{
        String path = <span class="string">"https://api.shanbay.com/bdc/search/?word="</span> + wordCls.getWord();
        <span class="keyword">try</span> {
            URL url = <span class="keyword">new</span> URL(path);
            Source source = <span class="keyword">new</span> Source(url.openConnection());   <span class="comment">//jericho-html-3.1.jar</span>
            String jsonstr = source.toString();

            JSONObject jsonObj = <span class="keyword">new</span> JSONObject(jsonstr);

            JSONObject data = jsonObj.getJSONObject(<span class="string">"data"</span>);

            JSONObject defEN = data.getJSONObject(<span class="string">"en_definition"</span>);
            definitionEN = defEN.getString(<span class="string">"pos"</span>) + <span class="string">"."</span> + defEN.getString(<span class="string">"defn"</span>); 

            JSONObject defCN = data.getJSONObject(<span class="string">"cn_definition"</span>);
            definitionCN = defCN.getString(<span class="string">"pos"</span>) + defCN.getString(<span class="string">"defn"</span>); 

            audioUrlUS = data.getString(<span class="string">"us_audio"</span>);

            <span class="keyword">return</span> <span class="keyword">true</span>;
        } <span class="keyword">catch</span> (Exception e) {
            Toast.makeText(mContext, <span class="string">"获取数据失败"</span>, Toast.LENGTH_SHORT).show();
            <span class="keyword">return</span> <span class="keyword">false</span>;
        }
    }
}

<span class="keyword">if</span> ( ! wordCls.isLoaded() ) {
    Handler <span class="keyword">handler</span> = <span class="keyword">new</span> Handler(){

        <span class="annotation">@Override</span>
        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>{    根据AsyncTask的执行结果传递的值来判断下一步操作
            <span class="keyword">if</span> (msg.what == position)
                horizonViewHolder.tvHint.setVisibility(View.INVISIBLE);
            <span class="keyword">else</span>
                horizonViewHolder.tvHint.setText(<span class="string">"数据获取失败，请重试"</span>);
        }

    };
    ParseJsonTask parseJsonTask = <span class="keyword">new</span> ParseJsonTask(horizonViewHolder, wordCls, position, <span class="keyword">handler</span>);
    parseJsonTask.execute();
} 
</code></pre><p>参考：</p>
<ul>
<li>1.<a href="http://blog.chinaunix.net/uid-29006784-id-3865030.html" target="_blank" rel="external">Json方式获取网络数据</a></li>
<li>2.<a href="http://sunzone.iteye.com/blog/2038135" target="_blank" rel="external">Android 之 网络访问服务器，解析JSON数据</a></li>
<li>3.<a href="http://blog.csdn.net/tengweitw/article/details/46506945" target="_blank" rel="external">【Qt编程】基于Qt的词典开发系列&lt;九&gt;—JSON数据解析</a></li>
<li>4.<a href="http://bbs.chinaunix.net/thread-4184233-1-1.html" target="_blank" rel="external">android两种方式获取AsyncTask返回值</a></li>
</ul>
<p>2015-9-17</p>
<h1 id="RecyclerView水平滑动类似viewpager——自定义方法实现">RecyclerView水平滑动类似viewpager——自定义方法实现</h1><p>之前继承的<a href="https://gist.github.com/lauw/fc84f7d04f8c54e56d56" target="_blank" rel="external">SnappingRecyclerView</a>，水平状态的时候，点击item里的TextView更新会出现错位，有时还会跑到第一个位置去，并且感觉他的有点复杂。。<br>然后发现自己写一个实现也并不难@_@ 我的每一个item都是全屏的卡片，所以这样就可以了。</p>
<pre><code><span class="keyword">private</span> <span class="function"><span class="keyword">void</span> <span class="title">scrollToCenter</span><span class="params">(RecyclerView recyclerView)</span> </span>{
    firstVisibleItemPosition = ((LinearLayoutManager)recyclerView.getLayoutManager()).findFirstVisibleItemPosition();
    lastVisibleItemPosition = ((LinearLayoutManager)recyclerView.getLayoutManager()).findLastVisibleItemPosition();

    <span class="keyword">if</span> ( firstVisibleItemPosition &lt; lastVisibleItemPosition ) {
        recyclerViewWidth = recyclerView.getWidth();
        firstVisibleChild = recyclerView.getChildAt(<span class="number">0</span>);
        firstChildVisibleWidth = firstVisibleChild.getRight();
        <span class="keyword">if</span> ( firstChildVisibleWidth &gt; ( recyclerViewWidth / <span class="number">2</span> ) )
            recyclerView.smoothScrollToPosition(firstVisibleItemPosition);
        <span class="keyword">else</span> <span class="keyword">if</span> ( firstChildVisibleWidth &lt; ( recyclerViewWidth / <span class="number">2</span> ) )
            recyclerView.smoothScrollToPosition(lastVisibleItemPosition);
    }
}

<span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onScrollStateChanged</span><span class="params">(<span class="keyword">final</span> RecyclerView recyclerView, <span class="keyword">int</span> newState)</span> </span>{
    <span class="keyword">super</span>.onScrollStateChanged(recyclerView, newState);

    <span class="keyword">switch</span> (newState) {
    <span class="keyword">case</span> RecyclerView.SCROLL_STATE_IDLE:
        <span class="keyword">switch</span> (wordCardAdapter.getItemViewType()) {
        <span class="keyword">case</span> TYPE_VIEW_HORIZON:
            scrollToCenter(recyclerView);
            <span class="keyword">break</span>;
        <span class="keyword">case</span> TYPE_VIEW_VERTICAL:
        <span class="keyword">default</span>:
            <span class="keyword">break</span>;
        }
        <span class="keyword">break</span>;
    <span class="keyword">case</span> RecyclerView.SCROLL_STATE_DRAGGING:
        <span class="keyword">break</span>;
    <span class="keyword">case</span> RecyclerView.SCROLL_STATE_SETTLING:
        <span class="keyword">break</span>;
 }
}
</code></pre><h1 id="actionbar下拉列表——PopupWindow">actionbar下拉列表——PopupWindow</h1><pre><code>View view = LayoutInflater.<span class="keyword">from</span>(context).inflate(R.layout.popmenu, <span class="keyword">null</span>);       
popupWindow = <span class="keyword">new</span> PopupWindow(view, <span class="number">100</span>, LayoutParams.WRAP_CONTENT);
<span class="comment">// 使其聚集</span>
popupWindow.setFocusable(<span class="keyword">true</span>);
<span class="comment">// 设置允许在外点击消失</span>
popupWindow.setOutsideTouchable(<span class="keyword">true</span>);
<span class="comment">//刷新状态（必须刷新否则无效）</span>
popupWindow.update();
<span class="comment">// 这个是为了点击“返回Back”也能使其消失，并且并不会影响你的背景</span>
popupWindow.setBackgroundDrawable(<span class="keyword">new</span> BitmapDrawable()); 

popupWindow.showAsDropDown(v); <span class="comment">//设置显示位置</span>
</code></pre><p>参考：</p>
<ul>
<li>1.<a href="http://www.apkbus.com/android-51289-1-1.html" target="_blank" rel="external">android 下拉菜单实现详解 PopupWindow </a></li>
</ul>
<p>2015-9-18</p>
<h1 id="RecyclerView高度wrap_content无效">RecyclerView高度wrap_content无效</h1><p><a href="https://github.com/serso/android-linear-layout-manager/blob/master/lib/src/main/java/org/solovyev/android/views/llm/LinearLayoutManager.java" target="_blank" rel="external">自定义<code>MyLayoutManager</code></a></p>
<pre><code><span class="comment">/*
 * Copyright 2015 serso aka se.solovyev
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *
 * Contact details
 *
 * Email: se.solovyev@gmail.com
 * Site:  http://se.solovyev.org
 */</span>

<span class="keyword">package</span> org.solovyev.android.views.llm;

<span class="keyword">import</span> android.content.Context;
<span class="keyword">import</span> android.graphics.Rect;
<span class="keyword">import</span> android.support.v4.view.ViewCompat;
<span class="keyword">import</span> android.support.v7.widget.RecyclerView;
<span class="keyword">import</span> android.util.Log;
<span class="keyword">import</span> android.view.View;

<span class="keyword">import</span> java.lang.reflect.Field;

<span class="comment">/**
 * {@link android.support.v7.widget.LinearLayoutManager} which wraps its content. Note that this class will always
 * wrap the content regardless of {@link android.support.v7.widget.RecyclerView} layout parameters.
 * &lt;p/&gt;
 * Now it's impossible to run add/remove animations with child views which have arbitrary dimensions (height for
 * VERTICAL orientation and width for HORIZONTAL). However if child views have fixed dimensions
 * {@link #setChildSize(int)} method might be used to let the layout manager know how big they are going to be.
 * If animations are not used at all then a normal measuring procedure will run and child views will be measured during
 * the measure pass.
 */</span>
<span class="keyword">public</span> class LinearLayoutManager extends android.support.v7.widget.LinearLayoutManager {

    <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">boolean</span> canMakeInsetsDirty = <span class="keyword">true</span>;
    <span class="keyword">private</span> <span class="keyword">static</span> Field insetsDirtyField = <span class="keyword">null</span>;

    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">int</span> CHILD_WIDTH = <span class="number">0</span>;
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">int</span> CHILD_HEIGHT = <span class="number">1</span>;
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">int</span> DEFAULT_CHILD_SIZE = <span class="number">100</span>;

    <span class="keyword">private</span> <span class="keyword">final</span> <span class="built_in">int</span>[] childDimensions = <span class="keyword">new</span> <span class="built_in">int</span>[<span class="number">2</span>];
    <span class="keyword">private</span> <span class="keyword">final</span> RecyclerView view;

    <span class="keyword">private</span> <span class="built_in">int</span> childSize = DEFAULT_CHILD_SIZE;
    <span class="keyword">private</span> <span class="built_in">boolean</span> hasChildSize;
    <span class="keyword">private</span> <span class="built_in">int</span> overScrollMode = ViewCompat.OVER_SCROLL_ALWAYS;
    <span class="keyword">private</span> <span class="keyword">final</span> Rect tmpRect = <span class="keyword">new</span> Rect();

    @SuppressWarnings(<span class="string">"UnusedDeclaration"</span>)
    <span class="keyword">public</span> LinearLayoutManager(Context context) {
        <span class="keyword">super</span>(context);
        <span class="keyword">this</span>.view = <span class="keyword">null</span>;
    }

    @SuppressWarnings(<span class="string">"UnusedDeclaration"</span>)
    <span class="keyword">public</span> LinearLayoutManager(Context context, <span class="built_in">int</span> orientation, <span class="built_in">boolean</span> reverseLayout) {
        <span class="keyword">super</span>(context, orientation, reverseLayout);
        <span class="keyword">this</span>.view = <span class="keyword">null</span>;
    }

    @SuppressWarnings(<span class="string">"UnusedDeclaration"</span>)
    <span class="keyword">public</span> LinearLayoutManager(RecyclerView view) {
        <span class="keyword">super</span>(view.getContext());
        <span class="keyword">this</span>.view = view;
        <span class="keyword">this</span>.overScrollMode = ViewCompat.getOverScrollMode(view);
    }

    @SuppressWarnings(<span class="string">"UnusedDeclaration"</span>)
    <span class="keyword">public</span> LinearLayoutManager(RecyclerView view, <span class="built_in">int</span> orientation, <span class="built_in">boolean</span> reverseLayout) {
        <span class="keyword">super</span>(view.getContext(), orientation, reverseLayout);
        <span class="keyword">this</span>.view = view;
        <span class="keyword">this</span>.overScrollMode = ViewCompat.getOverScrollMode(view);
    }

    <span class="keyword">public</span> <span class="keyword">void</span> setOverScrollMode(<span class="built_in">int</span> overScrollMode) {
        <span class="keyword">if</span> (overScrollMode &lt; ViewCompat.OVER_SCROLL_ALWAYS || overScrollMode &gt; ViewCompat.OVER_SCROLL_NEVER)
            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unknown overscroll mode: "</span> + overScrollMode);
        <span class="keyword">if</span> (<span class="keyword">this</span>.view == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"view == null"</span>);
        <span class="keyword">this</span>.overScrollMode = overScrollMode;
        ViewCompat.setOverScrollMode(view, overScrollMode);
    }

    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> makeUnspecifiedSpec() {
        <span class="keyword">return</span> View.MeasureSpec.makeMeasureSpec(<span class="number">0</span>, View.MeasureSpec.UNSPECIFIED);
    }

    @Override
    <span class="keyword">public</span> <span class="keyword">void</span> onMeasure(RecyclerView.Recycler recycler, RecyclerView.State state, <span class="built_in">int</span> widthSpec, <span class="built_in">int</span> heightSpec) {
        <span class="keyword">final</span> <span class="built_in">int</span> widthMode = View.MeasureSpec.getMode(widthSpec);
        <span class="keyword">final</span> <span class="built_in">int</span> heightMode = View.MeasureSpec.getMode(heightSpec);

        <span class="keyword">final</span> <span class="built_in">int</span> widthSize = View.MeasureSpec.getSize(widthSpec);
        <span class="keyword">final</span> <span class="built_in">int</span> heightSize = View.MeasureSpec.getSize(heightSpec);

        <span class="keyword">final</span> <span class="built_in">boolean</span> hasWidthSize = widthMode != View.MeasureSpec.UNSPECIFIED;
        <span class="keyword">final</span> <span class="built_in">boolean</span> hasHeightSize = heightMode != View.MeasureSpec.UNSPECIFIED;

        <span class="keyword">final</span> <span class="built_in">boolean</span> exactWidth = widthMode == View.MeasureSpec.EXACTLY;
        <span class="keyword">final</span> <span class="built_in">boolean</span> exactHeight = heightMode == View.MeasureSpec.EXACTLY;

        <span class="keyword">final</span> <span class="built_in">int</span> unspecified = makeUnspecifiedSpec();

        <span class="keyword">if</span> (exactWidth &amp;&amp; exactHeight) {
            <span class="comment">// in case of exact calculations for both dimensions let's use default "onMeasure" implementation</span>
            <span class="keyword">super</span>.onMeasure(recycler, state, widthSpec, heightSpec);
            <span class="keyword">return</span>;
        }

        <span class="keyword">final</span> <span class="built_in">boolean</span> vertical = getOrientation() == VERTICAL;

        initChildDimensions(widthSize, heightSize, vertical);

        <span class="built_in">int</span> <span class="variable">width</span> = <span class="number">0</span>;
        <span class="built_in">int</span> <span class="variable">height</span> = <span class="number">0</span>;

        <span class="comment">// it's possible to get scrap views in recycler which are bound to old (invalid) adapter entities. This</span>
        <span class="comment">// happens because their invalidation happens after "onMeasure" method. As a workaround let's clear the</span>
        <span class="comment">// recycler now (it should not cause any performance issues while scrolling as "onMeasure" is never</span>
        <span class="comment">// called whiles scrolling)</span>
        recycler.<span class="built_in">clear</span>();

        <span class="keyword">final</span> <span class="built_in">int</span> stateItemCount = state.getItemCount();
        <span class="keyword">final</span> <span class="built_in">int</span> adapterItemCount = getItemCount();
        <span class="comment">// adapter always contains actual data while state might contain old data (f.e. data before the animation is</span>
        <span class="comment">// done). As we want to measure the view with actual data we must use data from the adapter and not from  the</span>
        <span class="comment">// state</span>
        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; adapterItemCount; i++) {
            <span class="keyword">if</span> (vertical) {
                <span class="keyword">if</span> (!hasChildSize) {
                    <span class="keyword">if</span> (i &lt; stateItemCount) {
                        <span class="comment">// we should not exceed state count, otherwise we'll get IndexOutOfBoundsException. For such items</span>
                        <span class="comment">// we will use previously calculated dimensions</span>
                        measureChild(recycler, i, widthSize, unspecified, childDimensions);
                    } <span class="keyword">else</span> {
                        logMeasureWarning(i);
                    }
                }
                <span class="variable">height</span> += childDimensions[CHILD_HEIGHT];
                <span class="keyword">if</span> (i == <span class="number">0</span>) {
                    <span class="variable">width</span> = childDimensions[CHILD_WIDTH];
                }
                <span class="keyword">if</span> (hasHeightSize &amp;&amp; <span class="variable">height</span> &gt;= heightSize) {
                    <span class="keyword">break</span>;
                }
            } <span class="keyword">else</span> {
                <span class="keyword">if</span> (!hasChildSize) {
                    <span class="keyword">if</span> (i &lt; stateItemCount) {
                        <span class="comment">// we should not exceed state count, otherwise we'll get IndexOutOfBoundsException. For such items</span>
                        <span class="comment">// we will use previously calculated dimensions</span>
                        measureChild(recycler, i, unspecified, heightSize, childDimensions);
                    } <span class="keyword">else</span> {
                        logMeasureWarning(i);
                    }
                }
                <span class="variable">width</span> += childDimensions[CHILD_WIDTH];
                <span class="keyword">if</span> (i == <span class="number">0</span>) {
                    <span class="variable">height</span> = childDimensions[CHILD_HEIGHT];
                }
                <span class="keyword">if</span> (hasWidthSize &amp;&amp; <span class="variable">width</span> &gt;= widthSize) {
                    <span class="keyword">break</span>;
                }
            }
        }

        <span class="keyword">if</span> (exactWidth) {
            <span class="variable">width</span> = widthSize;
        } <span class="keyword">else</span> {
            <span class="variable">width</span> += getPaddingLeft() + getPaddingRight();
            <span class="keyword">if</span> (hasWidthSize) {
                <span class="variable">width</span> = Math.<span class="built_in">min</span>(<span class="variable">width</span>, widthSize);
            }
        }

        <span class="keyword">if</span> (exactHeight) {
            <span class="variable">height</span> = heightSize;
        } <span class="keyword">else</span> {
            <span class="variable">height</span> += getPaddingTop() + getPaddingBottom();
            <span class="keyword">if</span> (hasHeightSize) {
                <span class="variable">height</span> = Math.<span class="built_in">min</span>(<span class="variable">height</span>, heightSize);
            }
        }

        setMeasuredDimension(<span class="variable">width</span>, <span class="variable">height</span>);

        <span class="keyword">if</span> (view != <span class="keyword">null</span> &amp;&amp; overScrollMode == ViewCompat.OVER_SCROLL_IF_CONTENT_SCROLLS) {
            <span class="keyword">final</span> <span class="built_in">boolean</span> fit = (vertical &amp;&amp; (!hasHeightSize || <span class="variable">height</span> &lt; heightSize))
                    || (!vertical &amp;&amp; (!hasWidthSize || <span class="variable">width</span> &lt; widthSize));

            ViewCompat.setOverScrollMode(view, fit ? ViewCompat.OVER_SCROLL_NEVER : ViewCompat.OVER_SCROLL_ALWAYS);
        }
    }

    <span class="keyword">private</span> <span class="keyword">void</span> logMeasureWarning(<span class="built_in">int</span> child) {
        <span class="keyword">if</span> (BuildConfig.DEBUG) {
            Log.w(<span class="string">"LinearLayoutManager"</span>, <span class="string">"Can't measure child #"</span> + child + <span class="string">", previously used dimensions will be reused."</span> +
                    <span class="string">"To remove this message either use #setChildSize() method or don't run RecyclerView animations"</span>);
        }
    }

    <span class="keyword">private</span> <span class="keyword">void</span> initChildDimensions(<span class="built_in">int</span> <span class="variable">width</span>, <span class="built_in">int</span> <span class="variable">height</span>, <span class="built_in">boolean</span> vertical) {
        <span class="keyword">if</span> (childDimensions[CHILD_WIDTH] != <span class="number">0</span> || childDimensions[CHILD_HEIGHT] != <span class="number">0</span>) {
            <span class="comment">// already initialized, skipping</span>
            <span class="keyword">return</span>;
        }
        <span class="keyword">if</span> (vertical) {
            childDimensions[CHILD_WIDTH] = <span class="variable">width</span>;
            childDimensions[CHILD_HEIGHT] = childSize;
        } <span class="keyword">else</span> {
            childDimensions[CHILD_WIDTH] = childSize;
            childDimensions[CHILD_HEIGHT] = <span class="variable">height</span>;
        }
    }

    @Override
    <span class="keyword">public</span> <span class="keyword">void</span> setOrientation(<span class="built_in">int</span> orientation) {
        <span class="comment">// might be called before the constructor of this class is called</span>
        <span class="comment">//noinspection ConstantConditions</span>
        <span class="keyword">if</span> (childDimensions != <span class="keyword">null</span>) {
            <span class="keyword">if</span> (getOrientation() != orientation) {
                childDimensions[CHILD_WIDTH] = <span class="number">0</span>;
                childDimensions[CHILD_HEIGHT] = <span class="number">0</span>;
            }
        }
        <span class="keyword">super</span>.setOrientation(orientation);
    }

    <span class="keyword">public</span> <span class="keyword">void</span> clearChildSize() {
        hasChildSize = <span class="keyword">false</span>;
        setChildSize(DEFAULT_CHILD_SIZE);
    }

    <span class="keyword">public</span> <span class="keyword">void</span> setChildSize(<span class="built_in">int</span> childSize) {
        hasChildSize = <span class="keyword">true</span>;
        <span class="keyword">if</span> (<span class="keyword">this</span>.childSize != childSize) {
            <span class="keyword">this</span>.childSize = childSize;
            requestLayout();
        }
    }

    <span class="keyword">private</span> <span class="keyword">void</span> measureChild(RecyclerView.Recycler recycler, <span class="built_in">int</span> position, <span class="built_in">int</span> widthSize, <span class="built_in">int</span> heightSize, <span class="built_in">int</span>[] dimensions) {
        <span class="keyword">final</span> View child;
        <span class="keyword">try</span> {
            child = recycler.getViewForPosition(position);
        } <span class="keyword">catch</span> (IndexOutOfBoundsException e) {
            <span class="keyword">if</span> (BuildConfig.DEBUG) {
                Log.w(<span class="string">"LinearLayoutManager"</span>, <span class="string">"LinearLayoutManager doesn't work well with animations. Consider switching them off"</span>, e);
            }
            <span class="keyword">return</span>;
        }

        <span class="keyword">final</span> RecyclerView.LayoutParams p = (RecyclerView.LayoutParams) child.getLayoutParams();

        <span class="keyword">final</span> <span class="built_in">int</span> hPadding = getPaddingLeft() + getPaddingRight();
        <span class="keyword">final</span> <span class="built_in">int</span> vPadding = getPaddingTop() + getPaddingBottom();

        <span class="keyword">final</span> <span class="built_in">int</span> hMargin = p.leftMargin + p.rightMargin;
        <span class="keyword">final</span> <span class="built_in">int</span> vMargin = p.topMargin + p.bottomMargin;

        <span class="comment">// we must make insets dirty in order calculateItemDecorationsForChild to work</span>
        makeInsetsDirty(p);
        <span class="comment">// this method should be called before any get<span class="label">XxxDecorationXxx() methods</span></span>
        calculateItemDecorationsForChild(child, tmpRect);

        <span class="keyword">final</span> <span class="built_in">int</span> hDecoration = getRightDecorationWidth(child) + getLeftDecorationWidth(child);
        <span class="keyword">final</span> <span class="built_in">int</span> vDecoration = getTopDecorationHeight(child) + getBottomDecorationHeight(child);

        <span class="keyword">final</span> <span class="built_in">int</span> childWidthSpec = getChildMeasureSpec(widthSize, hPadding + hMargin + hDecoration, p.<span class="variable">width</span>, canScrollHorizontally());
        <span class="keyword">final</span> <span class="built_in">int</span> childHeightSpec = getChildMeasureSpec(heightSize, vPadding + vMargin + vDecoration, p.<span class="variable">height</span>, canScrollVertically());

        child.measure(childWidthSpec, childHeightSpec);

        dimensions[CHILD_WIDTH] = getDecoratedMeasuredWidth(child) + p.leftMargin + p.rightMargin;
        dimensions[CHILD_HEIGHT] = getDecoratedMeasuredHeight(child) + p.bottomMargin + p.topMargin;

        <span class="comment">// as view is recycled let's not keep old measured values</span>
        makeInsetsDirty(p);
        recycler.recycleView(child);
    }

    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> makeInsetsDirty(RecyclerView.LayoutParams p) {
        <span class="keyword">if</span> (!canMakeInsetsDirty) {
            <span class="keyword">return</span>;
        }
        <span class="keyword">try</span> {
            <span class="keyword">if</span> (insetsDirtyField == <span class="keyword">null</span>) {
                insetsDirtyField = RecyclerView.LayoutParams.class.getDeclaredField(<span class="string">"mInsetsDirty"</span>);
                insetsDirtyField.setAccessible(<span class="keyword">true</span>);
            }
            insetsDirtyField.<span class="built_in">set</span>(p, <span class="keyword">true</span>);
        } <span class="keyword">catch</span> (NoSuchFieldException e) {
            onMakeInsertDirtyFailed();
        } <span class="keyword">catch</span> (IllegalAccessException e) {
            onMakeInsertDirtyFailed();
        }
    }

    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> onMakeInsertDirtyFailed() {
        canMakeInsetsDirty = <span class="keyword">false</span>;
        <span class="keyword">if</span> (BuildConfig.DEBUG) {
            Log.w(<span class="string">"LinearLayoutManager"</span>, <span class="string">"Can't make LayoutParams insets dirty, decorations measurements might be incorrect"</span>);
        }
    }
}
</code></pre><p>参考：<a href="http://blog.csdn.net/guxiao1201/article/details/40425231" target="_blank" rel="external">RecyclerView高度随Item自适应</a></p>
<p>2015-9-19</p>
<h1 id="ListView高度">ListView高度</h1><p>在ListView下面有一个Button，ListView设置高度为<code>wrap_content</code>，当ListView高度超出屏幕时，Button就不显示了。<br>解决：<br>给ListView增加</p>
<pre><code><span class="label">android:</span>layout_weight=<span class="string">"1"</span> 
</code></pre><p>2015-9-21</p>
<h1 id="SearchView">SearchView</h1><h2 id="按返回键关闭SearchView">按返回键关闭SearchView</h2><pre><code><span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onBackPressed</span><span class="params">()</span> </span>{
    <span class="keyword">if</span> ( searchView != <span class="keyword">null</span> ) {
        <span class="keyword">if</span> (!searchView.isIconified()) {
            searchView.setIconified(<span class="keyword">true</span>);
        } <span class="keyword">else</span> {
            <span class="keyword">super</span>.onBackPressed();
        }
    }
}
</code></pre><p>参考：<a href="http://stackoverflow.com/a/17782575/5315255" target="_blank" rel="external">How do I close a SearchView programmatically?</a></p>
<h2 id="点击外部关闭SearchView">点击外部关闭SearchView</h2><pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setupUI</span><span class="params">(View view)</span> </span>{

    <span class="keyword">if</span>(!(view <span class="keyword">instanceof</span> SearchView)) {

        view.setOnTouchListener(<span class="keyword">new</span> OnTouchListener() {

            <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>{
                searchMenuItem.collapseActionView();
                <span class="keyword">return</span> <span class="keyword">false</span>;
            }

        });
    }

    <span class="comment">//If a layout container, iterate over children and seed recursion.</span>
    <span class="keyword">if</span> (view <span class="keyword">instanceof</span> ViewGroup) {

        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ((ViewGroup) view).getChildCount(); i++) {

            View innerView = ((ViewGroup) view).getChildAt(i);

            setupUI(innerView);
        }
    }
}
</code></pre><p>参考：<a href="http://stackoverflow.com/a/17591520/5315255" target="_blank" rel="external">how to make searchview loose focus and collapse when clicked elsewhere on activity</a></p>
<p>2015-9-22</p>
<h1 id="Sqlite判断记录是否存在">Sqlite判断记录是否存在</h1><pre><code>Cursor <span class="built_in">cursor</span> = db.query(……);
<span class="keyword">if</span> (<span class="built_in">cursor</span>.moveToNext())
    <span class="keyword">return</span> <span class="keyword">true</span>;
<span class="keyword">else</span>
    <span class="keyword">return</span> <span class="keyword">false</span>;
</code></pre>
      
    </div>
    <footer>
      
        
        
        <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"0","bdPos":"right","bdTop":"0"},"image":{"viewList":["tsina","qzone","sqq","renren","weixin","tieba"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","sqq","renren","weixin","tieba"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
      
      <div class="clearfix"></div>
    </footer>
  </div>
  
</article>



<nav id="pagination" >
    
    
    <a href="/2015/07/15/Android-notes/" class="alignright next" >下一篇</a>
    
    <div class="clearfix"></div>
</nav>

<section id="comment">
	
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','ezmTb2UZ-bmXA95SCea3','2.0.0');
</script>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/Android/">Android</a><small>1</small></li>
  
    <li><a href="/categories/Hexo/">Hexo</a><small>2</small></li>
  
    <li><a href="/categories/Java/">Java</a><small>2</small></li>
  
    <li><a href="/categories/前端/">前端</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/Android/">Android</a><small>2</small></li>
  
    <li><a href="/tags/Java/">Java</a><small>2</small></li>
  
    <li><a href="/tags/html/">html</a><small>1</small></li>
  
    <li><a href="/tags/前端/">前端</a><small>1</small></li>
  
    <li><a href="/tags/数据处理/">数据处理</a><small>1</small></li>
  
  </ul>
</div>


  <div class="widget tag">
	<h3 class="title">友情链接</h3>
	<ul class="entry">
	<li><a href="http://codingbubble.github.io/" title="bubble sky">bubble's blog</a></li>
	</ul>
</div>
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 bubble
  
</div>
<div class="clearfix"></div></footer>
  <script src="//libs.baidu.com/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



<div id="totop" style="position:fixed;bottom:150px;right:50px;cursor: pointer;">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>
<script src="/js/totop.js"></script>

  <a href="https://github.com/codingbubble"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/8b6b8ccc6da3aa5722903da7b58eb5ab1081adee/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_orange_ff7600.png"></a>
</body>
</html>
